<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="Cache-control" content="max-age=29030400,public">
<meta name="description" content="Magic The Gathering, magic cards, singles, decks, card lists, deck ideas, wizard of the coast, all of the cards you need at great prices are available at Cardkingdom.">
<meta name="keywords" content="Magic The Gathering, magic cards, magic the gathering and purchase, magic singles, magic the gathering pricelist, magic the gathering card lists, magic the gathering deck ideas, magic the gathering cards, magic the gathering cards sell, magic the gathering card prices, wizard of the coast, magic the gathering singles, magic the gathering decks, magic the gathering cardlist, cheap magic singles.">
<meta NAME="robots" CONTENT="index, follow">
<meta name="google-site-verification" content="mG_HnQSIpvWtvlgoloS5nWbuB7wNauY3RlU6dEmTLec" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="">


<link rel="icon" href="/favicon.ico">
<title>
    Card Kingdom - Magic: the Gathering, MTG, Magic Cards, Singles, EDH, Decks and Supplies        </title>
<link rel="stylesheet" href="/media/css/jquery-ui-1.9.2.custom.min.css">
<link rel="stylesheet" href="/media/css/bootstrap.min.css">
<link href="/media/css/cardkingdom.css?v=2124" rel="stylesheet">
<link href="/media/css/mobile.css?v=2124" rel="stylesheet">
<script> var ck = ck || {}; ck.version = "2124"; </script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="/media/js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="/media/js/lodash.min.js"></script>
<script src="/media/js/hammer.min.js"></script>


<script src="/media/js/ck_core.js?v=2124"></script>
<script src="/shared/media/packages/bootstrap/js/bootstrap.min.js"></script>
<script src="/media/js/cardkingdom.js?v=2124"></script>
<script src="/media/js/add_to_cart_btn.js?v=2124"></script>
<script src="/media/js/sidesearch.js?v=2124"></script>
<script>
    ck = ck || {};


    
;ck.isMobile=false;
    </script>

<!--[if lt IE 9]>
      <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<script src="/media/js/jquery.ckpromos.js?v=2124"></script>
<link rel="stylesheet" type="text/css" href="/media/css/ckbox.css?v=2124" media="screen, print" />
<link rel="stylesheet" type="text/css" href="/ckcms/css/ckcms.css?v=2124" media="screen, print" />



<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NDPBJW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NDPBJW');</script>



<script>(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"5105550"};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","https://bat.bing.com/bat.js","uetq");</script><noscript><img src="https://bat.bing.com/action/0?ti=5105550&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" /></noscript>

<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window,document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '325102331546565');
fbq('track', 'PageView');
</script>
<noscript>
<img height="1" width="1"
src="https://www.facebook.com/tr?id=325102331546565&ev=PageView
&noscript=1"/>
</noscript>

</head>

<body class=" static ">
<div class="header loggedOut">
<div class="container innerHeaderWrapper">
<a href="/" class="headerLogo"></a>
<a href="/" class="headerCompanyName"></a>
<div class="headerLinks loggedOut">
<div class="input-group headerSearch">
<a href="/catalog/magic_the_gathering/by_az" class="headerMtgLink"></a>
<div id="autocomplete">
<div class="ui-widget">
<form id="headersearch" action="/catalog/search" role="form">
<input type=hidden name=search value="header">
<span class="searchFieldWrapper"><input type="text" name="filter[name]" value="" id="tags" class="form-control ui-autocomplete-input headerSearchInput" aria-describedby="basic-addon2" placeholder="Search Card Kingdom" autocomplete="off" autocorrect="off" autocapitalize="off" />
</span>
<span class="searchIconWrapper"><span class="searchIcon glyphicon glyphicon-search"></span></span>
</form>
</div>
<a id="advancedSearchButton" href="/catalog/magic_the_gathering/search">Advanced Search</a>
</div>
</div> 
<a href="/myaccount" class="myAccountLogin" rel="nofollow"><span class="glyphicon glyphicon-user"></span>Login / Register</a>
<div class="dropdown myAccountMenuWrapper">
<button class="dropdown-toggle myAccountMenu" type="button" data-toggle="dropdown" aria-expanded="false"><span class="glyphicon glyphicon-cog"></span><span class="myAccountLinkEmailText"></span>
</button>
<div class="caret"></div>
<ul class="dropdown-menu">
<li><a href="/myaccount/profile" rel="nofollow">My Account</a></li>
<li><a href="/myaccount/order_history" rel="nofollow">Order History</a></li>
<li><a href="/myaccount/selling_history" rel="nofollow">Selling History</a></li>
<li><a href="/myaccount/wishlist" rel="nofollow">Wishlist</a></li>
<li><a href="/customer_login/logout" rel="nofollow">Log out</a></li>
</ul>
</div>
<a href="https://cardkingdom.freshdesk.com/support/home" class="customerSupport"><span class="glyphicon glyphicon-heart"></span>Customer Service</a>
<div class="headerCart">
 <a href="/cart" class="itemCountWrapper" rel="nofollow">
<span class="icon"></span>
<span class="itemCount empty" title="Items to Buy">0</span>
</a>
<a href="/sellcart" class="sellCountWrapper" rel="nofollow">
<span class="icon"></span>
<span class="sellItemCount empty" title="Items to Sell">0</span>
</a>
</div>
</div>
<span class="miniHeaderMenuIcon glyphicon glyphicon-menu-hamburger"></span>
<div class="mainMenu"><div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>MAGIC:&nbsp;THE GATHERING</b></span>
<ul class="dropdown-menu" id="MenuList0"><li class="advanced_search"><a href="/search/mtg">Advanced Search</a></li><li class="deck_builder"><a href="/builder">Deck Builder</a></li><li class="mtg_editions_az"><a href="/catalog/magic_the_gathering/by_az">MTG Editions A-Z</a></li><li class="divider"></li><li class="menuSubHeading">Upcoming Editions</li><li class="throne_of_eldraine"><a href="/mtg/throne-of-eldraine/singles">Throne of Eldraine</a></li><li class="divider"></li><li class="menuSubHeading">Recent Editions</li><li class="core_set_2020"><a href="/mtg/core-set-2020/singles">Core Set 2020</a></li><li class="war_of_the_spark"><a href="/mtg/war-of-the-spark/singles">War of the Spark</a></li><li class="ravnica_allegiance"><a href="/mtg/ravnica-allegiance/singles">Ravnica Allegiance</a></li><li class="divider"></li><li class="menuSubHeading">Special Editions</li><li class="commander_2019"><a href="/mtg/commander-2019/singles">Commander 2019</a></li><li class="modern_horizons"><a href="/mtg/modern-horizons/singles">Modern Horizons</a></li><li class="challenger_decks"><a href="/mtg/challenger-decks/sealed">Challenger Decks</a></li><li class="divider"></li><li class="standard_format"><a href="/catalog/view/2779">Standard Format</a></li><li class="modern_format"><a href="/catalog/view/2864">Modern Format</a></li><li class="divider"></li><li class="complete_sets"><a href="/catalog/view/3049">Complete Sets</a></li><li class="bulk_playsets"><a href="/catalog/view/3040">Wholesale Products</a></li><li class="deals"><a href="/catalog/sale">Deals</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>CK&nbsp;EXCLUSIVES</b></span>
<ul class="dropdown-menu" id="MenuList1"><li class="specialties"><a href="/static/specialties">Specialties</a></li><li class="divider"></li><li class="battle_decks"><a href="/catalog/shop/battle-decks">Battle Decks</a></li><li class="rookie_decks"><a href="/catalog/view/3006">Rookie Decks</a></li><li class="sparring_decks"><a href="/catalog/view/3096">Sparring Decks</a></li><li class="draft_bundles"><a href="/catalog/view/3031">Draft/Bundles</a></li><li class="tokens"><a href="/mtg/card-kingdom-tokens">Tokens</a></li><li class="gift_cards"><a href="/catalog/giftcard">Gift Cards</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>GEAR</b></span>
<ul class="dropdown-menu" id="MenuList2"><li class="all_supplies"><a href="/static/mtg-supplies">All Supplies</a></li><li class="divider"></li><li class="albumspages"><a href="/mtg-supplies/albums-pages">Albums/Pages</a></li><li class="apparel"><a href="/mtg-supplies/apparel">Apparel</a></li><li class="card_sleeves"><a href="/mtg-supplies/card-sleeves">Card Sleeves</a></li><li class="deck_boxes"><a href="/mtg-supplies/deck-boxes">Deck Boxes</a></li><li class="playmats"><a href="/mtg-supplies/playmats">Playmats</a></li><li class="stonescountersdice"><a href="/mtg-supplies/stones-counters-dice">Stones/Counters/Dice</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>COMMUNITY</b></span>
<ul class="dropdown-menu" id="MenuList3"><li class="ck_blog"><a href="https://blog.cardkingdom.com/">CK Blog</a></li><li class="ck_streams"><a href="https://twitch.tv/cardkingdom">CK Streams</a></li><li class="tcc_gift_guide"><a href="/static/tcc-campus-store">Tolarian Community College</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>SELL CARDS</b></span>
<ul class="dropdown-menu" id="MenuList4"><li class="mtg_singlesfoils"><a href="/purchasing/mtg_singles?filter[sort]=price_desc">MTG Singles/Foils</a></li><li class="mtg_sealedsetsbulk"><a href="/purchasing/mtg_sealed">MTG Sealed/Sets</a></li><li class="import_from_csv"><a href="/static/csvImport">Import From CSV</a></li><li class="sell_your_mtg_collection"><a href="/purchasing/sell_collection">Sell Your MTG Collection</a></li><li class="sell_mtg_in_bulk"><a href="/purchasing/mtg_bulk">Sell MTG in Bulk</a></li><li class="divider"></li><li class="selling_instructions"><a href="/purchasing/how_to_sell">Selling Instructions</a></li><li class="sellCartMenuLink"><a href="/sellcart">Sell Cart</a></li></ul></div></div></div> 
</div>
</div>
<div style="clear:both;"></div>

<div class="softOverlay"></div>
<div class="container mainWrapper ">
<div class="ckPromo1"></div>
<div class="globalPromo container">
<div class="promoSpot item1">
<a>
<div class="itemImage"></div>
<span class="icon"></span>
<h3 class=""><span></span></h3>
<div class="text"></div>
</a>
</div>
<div class="promoSpot item2">
<a href="">
<div class="itemImage"></div>
<span class="icon"></span>

<h3 class=""><span></span></h3>
<div class="text"></div>
</a>
</div>
<div class="promoSpot item3">
<a href="">
<div class="itemImage"></div>
<span class="icon"></span>

<h3 class=""><span></span></h3>
<div class="text"></div>
</a>
</div>
</div>
<script src="/media/js/csvparse/papaparse.js"></script>
<script src="/media/js/csvparse/Dexie.min.js"></script>
<script src="/media/js/csvparse/vue.min.js"></script>

<style>
    /**overrides*/
    hr{border:1px solid #ccc; margin:15px;}
    .foil{position: relative;}
    
    .anchor{display: block;height: 55px;}
    .headerCart{ display: none;}
    h1{margin-top: 0px;}
    h2{font-size: 18px;padding: 30px 0px 0px 0px;}
    .resultsWrapper h2 {
        display: inline;
        margin-top: 0px;
        padding-top: 0px;
    }
    h3{ 
        font-style: normal;
        margin-top: 0px;
    }
    h4{ padding:20px 0px 30px 0px;}
    .resultsAvailable h4{ padding:0px 0px 45px 0px;}
    .parseError .csvImportHeading h4{display: none;}

    #csvImportWrapper{padding: 15px;}
    .oneTwoThree{
        border: 2px solid #1958cc;
        clear:both;
        color: #1958cc;
        display: inline;
        font-size: 18px;
        font-weight: 500;  
        list-style-type: none;
        margin: 30px auto;
        overflow: auto;
        padding: 40px 10px;
        position: relative;
        width: 960px;  
}
    .oneTwoThree li{
        display: inline-block;
        padding: 20px 10px;
    }
    .oneTwoThree .countIcon {
        border: 2px solid #1958cc;
        border-radius: 40px;
        display: inline-block;
        font-size: 32px;
        margin-right: 10px;
        padding: 6px 18px;
    }
    .oneTwoThree .desc { vertical-align: super; }


    @media only screen and (max-width: 1200px) {
        .oneTwoThree{
            display: block;
            margin: 15px;
            width: auto;
            padding: 5px;
        }
    }
       
.maxLimitNotice{
    color: #1958cc;
    padding: 0px 20px;
    display: inline-block;
    font-size: 18px;
    font-weight: 300;
    font-style: italic;
}
    /* vuewjs css related directives*/
    [v-cloak] {display: none;}

    /*vuewjs feedback app*/
    #feedbackMsg{
        left: 0px;
        max-height: 60%;
        padding: 0;
        position: fixed;
        overflow: auto;
        text-align: center;
        top: 0px;
        width: 100%;
        z-index: 1001;
        webkit-box-shadow: 1px 3px 7px 0px rgba(0,0,0,0.41);
        -moz-box-shadow: 1px 3px 7px 0px rgba(0,0,0,0.41);
        box-shadow: 1px 3px 7px 0px rgba(0,0,0,0.41);
    }
    #feedbackMsg .feedbackWrapper{
        background-color: crimson;
        padding: 20px 55px;
    }
    #feedbackMsg .feedbackWrapper.welcome{
        background-color: cornflowerblue;
    }
     #feedbackMsg:after {
        color:#fff;
        content: 'x';
        display: block;
        font-size: 18px;
        position: absolute;
        right: 15px;
        line-height: 18px;
        border: 2px solid #fff;
        border-radius: 20px;
        padding: 0px 5px 1px 5px;
        top: 15px;
    }
    #feedbackMsg p {color:#fff;}
    #feedbackMsg .warning {color:#ff0;}
    #feedbackMsg .success {color:forestgreen; font-weight:500;}
     #feedbackMsg .hilight {font-weight:700;}
    #feedbackMsg a {color:gold; text-decoration: underline;}
    .resultsPanel  li  .dThumbnail.showImage:after {
        color: #fff;
        content: 'x';
        display: block;
        font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
        font-size: 30px;
        position: absolute;
        right: 15px;
        line-height: 18px;
        border: 2px solid #fff;
        border-radius: 20px;
        padding: 0px 3px 5px;
        top: 10px;
        font-weight: 700;
    }

    /*csvImport */
    .resultsPanel,
     #csvImportOptions li{ 
        background-color: #f6f6f6; 
        /*border: 2px solid #ddd; */
        margin-bottom: 15px; 
        padding: 15px;
    }
    .resultsPanel{padding: 0px; } 
    #csvImportOptions{padding-left:20px;}
    #csvImportOptions textarea,
    #csvImportOptions input {display: block; margin-top:15px; }
    #csvImportOptions textarea { 
        height:150px; 
        resize: both;
        overflow: scroll;
        width: 100%;
        white-space: nowrap; 
    }
    .loadBuyListWrapper{position: relative;}
    .resultsWrapper a,
    .loadBuyListWrapper a{text-decoration: underline;}
    .csvImportCart,
    #csvProcessingResults,
    #csvImportOptions li,
    #loadingCsvMsg,
    .resultsPanel {
        /*max-height: 250px; 
        overflow: auto;*/
        -webkit-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
        -moz-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
        box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
    }
    #csvUrl{width: 100%;}
    .specialResults #multiResults { max-height: 250px; }
    .specialResults #multiResults.showZoomedItems { max-height: 450px;  padding-bottom: 100px; }
    
    .disableCart .addAllToCartWrapper{display: none;}

    /*.expand .resultsPanel{max-height: none !important;}*/
    .resultsPanel li{
        list-style: none;
         display: -webkit-flex;
        display: flex;
        padding: 7px;
    }
    .resultsPanel .editionWrapper:nth-child(odd){ background-color: #eee;}


    .resultsPanel .editionWrapper .editionName{font-weight: 700; text-transform: capitalize; /*: 15px 0px 0px 5px;*/}
    .csvResultsHeader {
        font-weight: 500; 
        display:none;
        position: relative;}

    .specialResults .csvResultsHeader,
    .hasResults .csvResultsHeader {display: -webkit-flex;display: flex;}
    .csvResultsHeader  .dCart {text-align: center;}
    .resultsPanel  li > span {
        padding: 3px 10px;
        /*padding-top: 7px !important;*/
        -webkit-flex: 1;  /* Safari 6.1+ */
        -ms-flex: 1;  /* IE 10 */    
        flex: 1;
    }
    .resultsPanel .csvResultsHeader{background-color: #ddd; }
     .resultsPanel  li > .dName {
        padding: 3px 10px;
        -webkit-flex: 3;  /* Safari 6.1+ */
        -ms-flex: 3;  /* IE 10 */    
        flex: 3;
    }
    .resultsPanel  li > .dSet {
        padding: 3px 10px;
        text-transform: capitalize;
        -webkit-flex: 3;  /* Safari 6.1+ */
        -ms-flex: 3;  /* IE 10 */    
        flex: 3;
    }
    /* #addAllToCart {cursor: pointer; text-decoration: underline; font-weight: 500;}*/
    .addAllToCartIcon,
    .resultsPanel  li  .csvAddToCart { 
        color:#55a002;
        cursor: pointer;
        font-size: 25px;
        line-height: 30px;
        padding-top: 0px !important;
        text-align: center;

    }
    .resultsPanel  li .foil{
        margin: 3px 0px 0px 5px;
        padding: 1px 3px!important;
    }
    .resultsPanel  li  .dThumbnail{color:cadetblue; cursor:pointer; font-size: 18px; }

    .resultsPanel  li  .dThumbnail img{ display: none;  }

    .resultsPanel  li  .dThumbnail.showImage { 
        color: transparent;
        background-color: #000;
        height: 100%;
        left: 0px;
        position: fixed;
        top:0px;
        width: 100%;
        z-index: 1500;      
    }
    .resultsPanel  li  .dThumbnail.showImage img{ 
        display: block; 
        left: 50%;
        max-height: 100%;
        max-width: 100%;
        position: fixed;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 1501;

    }

     .addAllToCartIcon:after,
    .resultsPanel  li  .csvAddToCart:after {
        content: '+';
        position: absolute;
        color: #fff;
        font-size: 10px;
        line-height: 16px;
        margin: 4px auto auto -15px;
    }
    .addAllToCartIcon:after{margin-top: 5px;}
    .addAllToCart{margin: -8px 0px 0px 0px;    padding: 0px 0px 0px 25px !important;}
    .addAllToCart > .text {  color:#55a002; position: relative; top: -5px;    }
    .result .inCart.csvAddToCart{color: #ccc;  background-color: #55a002;}
    .resultsPanel  li  .inCart.csvAddToCart:after { content: '-'; font-size: 26px; margin-top: -1px;}
    .resultsWarning {  color: chocolate;  font-weight: 300; }
    #csvImportOptions > li,
    .resultsPanel {
        -webkit-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
        -moz-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
        box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.4);
    }
    #csvCartQty,
    #csvCartAmount{font-weight: 700;}

    .overMaxCards {
        background: yellow;
        color: black;
        padding: 10px 10px 10px 0px;
    }

    

    /*interaction css*/
    body.processingCsv .maxLimitNotice,
    body.loadingCsv .maxLimitNotice,
    body.loadingCsv .oneTwoThree,
    body.processingCsv .oneTwoThree,
    body.loadingCsv .csvImportSelectWrapper,
    body.processingCsv .csvImportSelectWrapper,
    body.loadingCsv #csvImportOptions,
    body.processingCsv #csvImportOptions, 
    .parseError .oneTwoThree,
    .parseError .csvImportSelectWrapper,
    .parseError .csvImportOptions,
    body.processingCsv.parseError #csvProcessingResults,
    .resultsWrapper,
    #errorWrapper,
    #loadingCsvMsg,
    #csvProcessingResults {display: none;}

    .parseError #errorWrapper{display: block; margin-top:100px;}
    /*#csvSetColumns, */
    body.loadingCsv #loadingCsvMsg,
    body.processingCsv #csvProcessingResults {
        display: inline-block;
        font-weight: 600;
        font-style: italic;
        font-size: 16px;
        background-color: #f6f6f6;
        margin-bottom: 20px;
        margin-left: 10px;
        width: 60%;
        padding: 15px;
    }
    #transferingToCartWrapper.isLarge .loader,
    .loadingCsv #loadingCsvMsg .loader{display: block;}

     .ckSelect {    
        background-color: #fefefe;
        left: 50%;
        margin-left: -64px;
        padding: 0px;
        position: absolute;
        top: 50px;
        width: 125px;
        z-index: 1;
    }
    .ckSelect > li { 
        cursor: pointer;
        display: block; 
        border:1px solid cornflowerblue; 
        border-top:none; 
    }
    .ckSelect > li,
    .headerPlaceHolder{
        text-transform: capitalize;
        -webkit-touch-callout: none;
        -webkit-user-select: none; 
        -moz-user-select: none; 
        -ms-user-select: none; 
        user-select: none;
    }
    .headerPlaceHolder{ 
        background-color: #405577;
        color: #fff;
        min-width: 140px;
        line-height: 45px;
        margin: 5px;
      
    }
    #setNoFoils:active,
    #setQtyOne:active,
    .headerPlaceHolder:active{background-color: cornflowerblue}
     .headerPlaceHolder.isset{background-color: #55a002;} 
    .ckSelect > li:hover{
        display: block;  
        background-color: cornflowerblue; 
        color:#fff; 
        font-weight: 300 !important; 
        -webkit-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.2);
        -moz-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.2);
        box-shadow: 1px 1px 4px 0px rgba(0,0,0,0.2);
    } 
   
    .ckSelect > li:hover{font-weight: 700; } 
    #csvSetColumns td {
        border-right: 1px solid #999;
        position: relative;
        text-align: center;
        vertical-align: text-bottom;
        min-width: 140px;
    }
    #csvSetColumns td:last-child{border-right:none;}

    body.loadingCsv #loadingCsvMsg {color:cornflowerblue;}

    #errorWrapper > h2 { padding-top: 0px;}

    body.resultsAvailable .resultsWrapper{display: block; padding-top: 30px; position: relative;}
    body.resultsAvailable .resultsWrapper.bulkWrapper > .resultsWrapper{ display: none;}
    body.resultsAvailable .resultsWrapper.bulkWrapper > .resultsWrapper{ display: none;}
    body.resultsAvailable .resultsWrapper.bulkWrapper > .resultsWrapper.hasResults{display: block;}
    #specialValueResults,
    #specialValueResults .dTotal{display: none;}
    .hasResults  #specialValueResults{display: block; padding-top: 0px;}
    body.resultsAvailable .resultsWrapper.bulkWrapper{
        display: none;
        /*background-color: aliceblue;*/
        padding: 10px; 
        margin-top: 40px; 
    
    }
    body.resultsAvailable .resultsWrapper.bulkWrapper.activeWrapper{display: block;}
    #unidentifiedCards{display: none; /*background-color: antiquewhite;*/padding: 10px; }
    #unidentifiedCards h2{text-transform: capitalize;}
    .bulkWrapper.activeWrapper,
    #unidentifiedCards.activeWrapper{display: block;}
    .csvImportCart {
        background-color: #fff;
        border: 2px solid #091f47;
        float: right;
        padding: 5px;
        position: absolute;
        right: 0px;
        top: 100px;
        width: 300px;
        transition: top 1s;
        -webkit-transition: top 1s;
        z-index: 10;
        
    }

    .addingToCart .csvImportCart { }
    /*.resultsAvailable .csvHelp,*/
    .cardsInCart,
    .cardsInCartValue,
    .checkoutButton{cursor: pointer; display: none;}
    .resultsAvailable .cardsInCart,
    .resultsAvailable .cardsInCartValue,
    .resultsAvailable .ready .checkoutButton{display: block; margin-top: 5px;} 

    .toggleResultsHeight {
        color: #091f47;
        display: none; /*PULL CODE IN CSS * HTML/JS IF NOT USING LONG TERM*/
        font-size: 16px;
        line-height: 20px;
        padding: 3px;
        position: absolute;
        right: 0px;
        top: -8px;
    }
    /*.hasManyResults .toggleResultsHeight { display: inline-block; }*/
    /*
    .expand .toggleResultsHeight.glyphicon-resize-full,
    .toggleResultsHeight.glyphicon-resize-small { display: none}
    .expand .toggleResultsHeight.glyphicon-resize-small { display: block}
    */
    .csvEditInvalidItem{
        color:cornflowerblue; 
        cursor: pointer;
        flex: .5;
        text-align: center;
    }
    .editInProgress .csvEditInvalidItem {cursor: default; color: #aaa;}
    .csvEditInvalidItem:hover{font-weight: 700;}

    .csvResetInvalidItem{
        color:chocolate; 
        cursor: pointer; 
        display: none;
        flex: .5;
        text-align: center;
    }
    .editing .csvResetInvalidItem{ display: inline-block; }
    .editing .csvEditInvalidItem{display: none;}
    .editing .dName {    }
    .editing.editingTitle .dName > .editText:not(.updated) {
        background-color: #fff;
        border: 1px solid cornflowerblue;
        display: block;
        padding: 0px 5px;
        -webkit-box-shadow: inset 1px 1px 3px 0px rgba(0,0,0,0.3);
        -moz-box-shadow: inset 1px 1px 3px 0px rgba(0,0,0,0.3);
        box-shadow: inset 1px 1px 3px 0px rgba(0,0,0,0.3);
    }
    .reParseButton{ 
        /*float: right; margin-bottom: 15px;*/
        cursor: not-allowed;
         margin-top: -50px;
         opacity: .2; 
        position: absolute;
        right: 0px;
   }
    .reParseButton.active{cursor:pointer; opacity: 1;}
    .reParseButton:after{
        color: red;
        content: 'Please set Title, Edition, Qty and Foil.';
        margin-left: -200px;
        margin-top: -25px;    
        position: absolute;    
    }
    .reParseButton.active:after{
        content: '';
        display: none;
    }

    .dFoilList,
    .setEdition,
    .dNameList{       
        border: 2px solid cornflowerblue;
        background-color: #fff;
        list-style: none;
        padding: 0px;
        position: absolute;
        z-index: 11;
        max-height: 300px;
        overflow: auto;
    }
    .dFoilList  li,
    .setEdition  li,
    .dNameList  li{ 
        cursor: pointer;
        padding: 10px; 
        -webkit-user-select: none; 
        -moz-user-select: none; 
        -ms-user-select: none;
        user-select: none; 
    }  
    .dFoilList  .dFoilOption:hover,
    .setEdition  .setEditionItem:hover,
    .dNameList  .dNameOption:hover{ 
        background-color: cornflowerblue; 
        color:#fff;
        
    }  
    .setEdition .setEditionItem.selected{background-color: cornflowerblue; 
        color:#fff;}
    .saveEditedCard {
        position: absolute;
        right: 25px;
        margin-top: -8px;
    }
    .thumb > img { height: 100px;}
    .thumb.zoom > img{
        border: 4px solid cornflowerblue;
        cursor: pointer;
        height: 300px;
        margin-left: -100px;
        margin-top: -90px;
        position: absolute; 
        -webkit-box-shadow: 2px 2px 4px 0px rgba(0,0,0,0.6);
        -moz-box-shadow: 2px 2px 4px 0px rgba(0,0,0,0.6);
        box-shadow: 2px 2px 4px 0px rgba(0,0,0,0.6);
    }
    .multiHitsString .thumb.zoom{ z-index: 1;}

    .multiHitsString .thumb{ display: inline-block; height:105px; float: left; position: relative; width: 100px;}  

    .multiHitsString .thumb:not(.zoom):hover::after{
        background-color: cornflowerblue;
        bottom: 36px;
        color: white;
        content: "set";
        padding: 1px 9px;
        position: absolute;
        right: 46%;
        text-shadow: 1px 1px 2px rgba(150, 150, 150, 1);
        width: auto;
    }

    .resultsPanel  li  span{}
    .resultsPanel  li.multiHitItem  .dName {
        padding: 3px 10px;
        -webkit-flex: 6;  /* Safari 6.1+ */
        -ms-flex: 6;  /* IE 10 */    
        flex: 6;       
    }
    .multiHitItem  .dQty {text-align: right; }

    /* #multiResults{ min-height: 350px;} */
    .resultsPanel  li .contactBuyer { flex:2;}


    .disableCart .resultsPanel  li .csvAddToCart,
    .disableCart .resultsPanel  li .addAllToCart{display: none;}

    .postProcessElement {display: none;}
    .resultsAvailable .postProcessElement{display: block;}

    .inlineHelpText{
        font-weight: 200;
        font-style: italic;
        padding-left: 10px;
    }
    
    body.resultsAvailable .resultsWrapper.singlesWrapper{display: none;}
    body.resultsAvailable .resultsWrapper.singlesWrapper.hasResults{display: block;}
    .singlesWrapper .toggleResultsHeight{top:-2px;}

    .resultsPanel .csvResultsHeader {
        height: 40px;
        position: absolute;
        top:50px;
        width: 100%;
        z-index: 1;
    }
    .resultsPanel{
        color:#333;
        display: block;
        /*max-height: 1000px;*/
        overflow: auto;
        padding-top: 50px;
    }
    #errorWrapper .resultsPanel{padding: 15px 15px 40px 15px;}

    #csvImportFaq a,
    .viewCsvFaq{ color: #1958cc; cursor: pointer; text-decoration: underline; }
    .csvFaq{display:none;}
    #csvImportFaq .faqSection {padding: 5px 15px;}
    

    .qtySelectList {    
        background-color: #fff;
        bottom: -105px;
        height: 140px;
        left: -100px;
        overflow: auto;
        padding: 5px;
        position: absolute;
        width: 214px;
        z-index: 9999;
        text-align: center;
    }
    .qtySelectList li {
        background-color: #f2f2f2;
        cursor: pointer;
        display: inline-block;
        font-size: 14px;
        font-weight: 500;
        padding: 9px 10px;
        text-align: center;
        width: 46px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        border: 1px solid #ddd;
        /* border-radius: 20px; */
        margin: 0px 5px 3px 0px;
        /*background-color: #eee;*/
    }
    .qtySelectList .label{
        display: block;
        border: none;
        width: 100%;
        color: #444;
        background-color: transparent;
    }
    .qtySelectList .none, .qtySelectList .all{ width: 40%;}

    .addAllSinglesToCart,
    .addAllBulkToCart {
        margin-top:10px;
    }
    .addAllToCartWrapper{text-align: center;}

    .sendUsFeedback{display:none; margin-top: 70px; text-align: center;}
    #csvImportFaq .sendUsFeedback {margin-top: 0px; text-align: left;}
    #csvImportFaq  .sendUsFeedback a {color: #fff; float: left; margin: 5px; text-decoration:none;}
    .sendUsFeedback p {margin: 10px;}
    #csvImportFaq .sendUsFeedback,
    .resultsAvailable .sendUsFeedback{display: block;}

/*Bulk Overrides*/

.bulkWrapper .resultsPanel .csvResultsHeader { background-color: #f6f6f6;}
.bulkWrapper  .title { font-size: 18px; line-height: 20px;}
.bulkWrapper .resultsPanel{ 
    background-color: #fdfdfd;
    -webkit-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0);
    -moz-box-shadow: 1px 1px 4px 0px rgba(0,0,0,0);
    box-shadow: 1px 1px 4px 0px rgba(0,0,0,0);
    
}
.bulkWrapper .resultsPanel .editionWrapper:nth-child(odd) { background-color: #f8f8f8;}

/* clearAndReset */
.itemsInCartNotice{ 
    display: none;
    background-color: lightyellow;
    font-size: 18px;
    font-style: italic;
    width: 848px;
    text-align: center;
    line-height: 30px;
    padding: 15px;
 }
 .disableCart .itemsInCartNotice{display: block;}
 .resultsAvailable .itemsInCartNotice{ width:700px;}
 .clearAndReset{cursor: pointer; user-select:none; }

/*reset button*/

.resetApp{
    color: #337ab7;
    display: none;
    font-weight: 500;
    position: absolute;
    top: -26px;
 
    }
.parseError .resetApp,  
.resultsAvailable .resetApp{display: block;}

.contactBuyer{font-style: italic;}
/* transferingToCart loading screen*/
#transferingToCartWrapper {
    background-color: #fff;
    display: none;
    height: 100%;
    left:0;
    position: fixed;
    top:0;
    width: 100%;
    z-index: 111;
}
#transferingToCartWrapper.active{display: block;}
#transferingToCartWrapper .transferingToCartMsg{
    display: inline-block;
    top: 20%;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
}
#transferingToCartWrapper .loader { position: relative;  margin: 0px auto 45px auto;}
#transferingToCartWrapper p {
    text-align: center;
}
#transferingToCartWrapper .largeTransfer {display: none;}
#transferingToCartWrapper.isLarge .largeTransfer {display: block;}

.unsupportedBrowser {display: none; padding: 15px;}
.unsupportedBrowser a{text-decoration: underline;}
.isMobile .mobileNotice,
.isMobile .unsupportedBrowser,
.ie .unsupportedBrowser,
.safari .unsupportedBrowser  {display: block;}

.mobileNotice,
.isMobile .desktopNotice,
.isMobile  #csvImportWrapper,
.ie #csvImportWrapper,
 .safari #csvImportWrapper {display: none;}


/* tab overrides to fit on current page */
.categoryTabs{
    padding-top: 0px;
}
.nav-tabs {
    border-bottom: none;
}
.nav-tabs>li {
    display: inline-block;
    float: none;
    position: relative;
}
.nav-tabs>li a{
background-color: transparent;
    border: none;
    border-bottom: 1px solid #091f47;
    border-radius: 0;
    padding: 6px 5px;
    margin: 4px;
}
.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
    
    background-color: #fff;
    border: none;
    border-bottom: 4px solid #091f47;
    font-weight: 700;
    padding: 6px 5px;
    margin: 4px;
}
.callout {
    color: #1958cc;
    display: block;
    font-style: italic;
}
@media only screen and (max-width: 1200px) {
     .csvImportCart{
        position: static;
    }
}

.checkoutButton .secure {
    display: inline !important;

</style>
<div id="csvImportWrapper">
<div v-cloak id="feedbackMsg" v-if="show" v-on:click="closeFeedback"><div class="feedbackWrapper" v-bind:class=panelType><feedback-msg v-for="msg in messages"><p v-bind:class=msg.msgType v-html="msg.text"></p></feedback-msg>
</div></div>
<div class="csvImportHeading">
<div class="csvImportCart">
<div class="cardsInCart"><b>Cards to Sell</b>
<br>Lines: <span id="csvCartLineQty">0</span>/500, Cards: <span id="csvCartQty">0</span>/5000</div>
<div class="cardsInCartValue">Sell Total: $<span id="csvCartAmount">0.00</span></div>
<div class="checkoutButton">
<span class="secure">TRANSFER CARDS TO CARD KINGDOM CART</span>
<span class="glyphicon glyphicon-triangle-right"></span>
</div>
<div class="csvHelp"><span class="csvInitialFaq"><b>Questions about CSV files or how to use this tool?</b> Check out the <span class="viewCsvFaq">CSV Import FAQ</span></span>
<div class="csvFaq">
<h4>CSV Import FAQ</h4>
<b>What is a CSV file?</b><br><i>A file from an application(like Excel), or exported from a MtG Website (like QuietSpeculation.com).</i>
<br>The default format is:<br>
<b>title,edition,foil,qty</b><br>
<i>All other data will be unused</i>
</div>
</div>
</div>
<h1>CSV Import</h1>
<div class="categoryTabs">
<ul class="nav nav-tabs" role="tablist">
<li role="presentation"><a href="/purchasing/how_to_sell">Selling Instructions</a></li>
<li role="presentation"><a href="/purchasing/mtg_singles?filter[sort]=price_desc">MTG Singles/Foils</a></li>
<li role="presentation"><a href="/purchasing/mtg_sealed">MTG Sealed/Sets</a></li>
<li role="presentation"><a href="/purchasing/mtg_bulk">MTG Bulk</a></li>
<li role="presentation"><a href="/purchasing/sell_collection/template">Sell Your Collection</a></li>
<li role="presentation" class=active><a href="/static/csvImport">CSV Import</a></li>
<script>ck.productType = 'csvImport';</script>
</ul>
</div>
<h4>Quickly find the current value of your Magic The Gathering collection, in CSV format, and get paid in a snap!</h4>
 <p class="itemsInCartNotice"> There are existing items in your cart. <br>This tool can not add items to an existing cart.<br> <b><a href="/sellcart">View Current Sell Cart</a> | <a class="clearAndReset">Clear Current Sell Cart and Reload</a></b></p>
<ul class="oneTwoThree">
<li><span class="countIcon">1</span><span class="desc">Import your CSV card list</span></li>
<li><span class="countIcon">2</span><span class="desc">Select the cards you want to sell*</span></li>
<li><span class="countIcon">3</span><span class="desc">Get Paid</span></li>
</ul>
</div>
<div class="csvImportSelectWrapper">
<h2>Import CSV Options</h2><p>Choose a method of transferring your CSV Collection data:<span class="callout">Make sure the first four columns of your CSV contain: Card Name, Edition, Foil (1/true/yes and 0/false/no), and Quantity.</span></p>
<ol id="csvImportOptions" type="a">
<li><span>Upload a CSV file from your local computer</span><input type="file" id="csvFile" multiple=""></li>
<li><span>Paste your CSV text below</span><br>
<textarea id="csvPaste" placeholder="[title,edition,foil,quantity]"></textarea>
<input type=button id="convertPastedCsv" value="Import Pasted CSV Data" />
</li>
<li><span>Enter the full URL to a publicly available CSV file</span><input type="text" id="csvUrl" placeholder="Enter full URL" value="" /> <input type="button" name="submitCsvUrl" id="submitCsvUrl" value="Import CSV from Web URL"> </li>
</ol>
</div>
<p class="maxLimitNotice">* The maximum number of cards you can sell to Card Kingdom is 500 unique titles, or a total of 5000 cards.<br>
Cards with a quantity of 0 will be removed from the list, and not processed or displayed.</p>
</div>
<div class="unsupportedBrowser">
<h3>Unsupported Browser</h3>
<p class="desktopNotice">This application does not currently support your browser. </p>
<p class="mobileNotice">This application does not currently support mobile browsers. </p>
<p>To use this tool you will need to use a recent desktop version of <a href="https://www.google.com/chrome/" target="_blank">Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank">Firefox</a>.</p>
</div>
<div class="loadBuyListWrapper">
<div id="loadingCsvMsg">Loading Card Kingdom Buylist and your Collection. <div class="loader">Loading...</div></div>
<div id="errorWrapper">
<h2>The import tool did not identify your columns</h2>
<ul>
<li>Several rows from your data have been displayed. </li>
<li>Please click the correct column to identify the required data. (Title, Edition, Foil, Qty)</li>
<li>If your data does not include foil or quantity click the appropriate button below the example data.</li>
</ul>
<div class="btn btn-primary reParseButton">Parse CSV with new Fields</div>
<table id="csvSetColumns" class="resultsPanel"></table>
<p><span id="setNoFoils" class="btn btn-primary">No Foils</span> Click this button if your data does not include Foil information.</p>
<p><span id="setQtyOne" class="btn btn-primary">Set All Qty to 1</span> Click this button if your data does not include quantity.</p>
</div>
<a href="/static/csvImport" class="resetApp" title="Clear all card data, and start fresh">Clear all card data, and start fresh</a>
<div id="csvProcessingResults">
<h3>Status</h3>
<div>Processed <span id="cardsProcessedCount">0</span> of <span id="totalCardCount"></span> titles.</div>
<div class="postProcessElement">Cards Card Kingdom is buying individually: <span id="singlesCKisBuyingCount">0</span></div>
<div class="postProcessElement">Cards Card Kingdom is not currently buying: <span id="bulkCKisBuyingCount">0</span> <a href="#bulk">View</a> </div>
<div>Last card identified: <span id="lastCardIdentified"></span></div>
</div>
<div id="unidentifiedCards">
<div class="resultsWrapper specialResults">
<h2 class="csvResultsHeader">Cards with no matches: <span class="inlineHelpText">(Click pencil to edit with auto-complete.)</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></h2>
<ul class="resultsPanel" id="noResults"></ul>
</div>
<div class="resultsWrapper specialResults">
<h2 class="csvResultsHeader">Cards with more than one match:<span class="inlineHelpText">(click card thumbnail to zoom artwork and set qty.)</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></h2>
<ul class="resultsPanel" id="multiResults"></ul>
</div>
</div>
<div class="resultsWrapper singlesWrapper">
<div class="csvResultsHeader"><h2>Card Kingdom is buying the following cards individually:</h2><span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="singleResults"></ul>
</div
        <div class="resultsWrapper">
<div class="csvResultsHeader">The following high-value cards can not be valued or purchased with this tool. To get prices on these cards, please contact buyer@cardkingdom.com. <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="specialValueResults"></ul>
</div>
<a class="anchor" name="bulk"></a>
<div class="resultsWrapper bulkWrapper">
<h2>Card Kingdom is not currently buying the following cards individually.</h2><p>If the quantity of a card exceeded the quantity we will buy, the remainder will appear below.</p><p class="contactBuyer">If you are interested is selling the rest of these cards, checkout our <a href="/purchasing/mtg_bulk" target="_blank">Bulk Purchasing Program</a> or contact <a class="contactBuyer" href="mailto:buyer@cardkingdom.com">contact buyer@cardkingdom.com</a>.</p>
<div class="resultsWrapper bulkWrapperMythics">
<div class="csvResultsHeader"><span class="title">Mythics:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsMythics"></ul>
</div>
<div class="resultsWrapper bulkWrapperRares">
<div class="csvResultsHeader"><span class="title">Rares:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsRares"></ul>
</div>
<div class="resultsWrapper bulkWrapperCommonsUncommons">
<div class="csvResultsHeader"><span class="title">Commons/Uncommons:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsCommonsUncommons"></ul>
</div>
<div class="resultsWrapper bulkWrapperBasicLands">
<div class="csvResultsHeader"><span class="title">Basic Lands:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsBasicLands"></ul>
</div>
<div class="resultsWrapper bulkWrapperFoilsMythic">
<div class="csvResultsHeader"><span class="title">Foils - Mythic:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsFoilsMythic"></ul>
</div>
<div class="resultsWrapper bulkWrapperFoilsRare">
<div class="csvResultsHeader"><span class="title">Foils - Rare:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsFoilsRare"></ul>
</div>
<div class="resultsWrapper bulkWrapperFoilsCommonUncommon">
<div class="csvResultsHeader"><span class="title">Foils - Common/Uncommon:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsFoilsCommonUncommon"></ul>
</div>
<div class="resultsWrapper bulkWrapperFoilBasicLands">
<div class="csvResultsHeader"><span class="title">Foils - Basic Lands:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsFoilBasicLands"></ul>
</div>
<div class="resultsWrapper bulkWrapperPromos">
<div class="csvResultsHeader"><span class="title">Promotional Cards:</span> <span class="toggleResultsHeight glyphicon glyphicon-resize-full"></span> <span class="toggleResultsHeight glyphicon glyphicon-resize-small"></span></div>
<ul class="resultsPanel" id="bulkResultsPromos"></ul>
</div>
<div class="resultsWrapper bulkWrapperTokens">
<div class="csvResultsHeader"><span class="title">Tokens:</span></div>
<ul class="resultsPanel" id="bulkResultsTokens"></ul>
</div>
</div>
</div>
<div class="sendUsFeedback"><a class="btn btn-info" href="https://cardkingdom.freshdesk.com/support/tickets/new" target="_blank">Give us feedback on this tool</a><p>If you are having issues or have other feedback on this tool, please let us know. <br>Be sure to add "csv import tool" to the subject line!</p></div>
<form id="addToCartJsonForm" action="/sellcart/load_json" method="post">
<input type="hidden" id="finalCartContents" name="json" value="">
<input type="hidden" name="po_origin" value="1">
<input type="hidden" name="source" value="">
</form>
<script>
/* vuejs app for user feedback messages */
/* use: ck.notifyUser.addMsg('message_goes_here','customClass');*/
ck = ck || {};


ck.csvImport = ck.csvImport || {};
ck.csvImport.maxLineItems = 500;
ck.csvImport.maxCardCount = 5000;

ck.csvImport.itemFieldNames ={
    'id': 0,
    'name': 1,
    'edition': 2,
    'foil': 3,
    'qty': 4, 
    'hits': 5,
    'inCart':6,
    'bulkType':7
};  //change values to re-map to users column order
ck.csvImport.bulkTypes = {
  'mythics':{'type':'mythics','price':.25,'selector':'#bulkResultsMythics','desc':'Bulk Mythics','index':203744,'qty':0},
  'rares':{'type':'rares','price':.1,'selector':'#bulkResultsRares','desc':'Bulk Rares','index':203741,'qty':0},
  'commonsUncommons':{'type':'commonsUncommons','price':.003,'selector':'#bulkResultsCommonsUncommons','desc':'Bulk Commons/Uncommons','index':214673,'qty':0},
  'basicLands':{'type':'basicLands','price':.005,'selector':'#bulkResultsBasicLands','desc':'Bulk Basic Lands','index':214674,'qty':0},
  'foilMythics':{'type':'foilMythics','price':.25,'selector':'#bulkResultsFoilsMythic','desc':'Bulk Mythic Foils','index':214675,'qty':0},
  'foilRare':{'type':'foilRare','price':.1,'selector':'#bulkResultsFoilsRare','desc':'Bulk Rare Foils','index':214671,'qty':0},
  'foilCommonsUncommons':{'type':'foilCommonsUncommons','price':.04,'selector':'#bulkResultsFoilsCommonUncommon','desc':'Bulk Foils Common/Uncommon','index':214676,'qty':0},
  'promos':{'type':'promos','price':.05,'selector':'#bulkResultsPromos','desc':'Bulk Promotional Cards','index':214677,'qty':0},
  'tokens':{'type':'tokens','price':.003,'selector':'#bulkResultsTokens','desc':'Bulk Token Cards','index':215216,'qty':0},
  'foilBasicLands':{'type':'foilBasicLands','price':.04,'selector':'#bulkResultsFoilBasicLands','desc':'Bulk Foil Basic Lands','index':215217,'qty':0}
};
ck.notifyUser = new Vue({
    el: '#feedbackMsg',
    data: {
        panelType: '', //binds to css classfor overri
        show: false,
        messages: [], //ex: [{'text':'test1','msgType':'warning'}]
    },
    methods: {
        addMsg: function (msg,msgType) {
            if( this.messages.length ===0 ) { this.messages.push({'text':' ','msgType':'init'}); }

            if( _.findIndex(this.messages,function(o){ return o.text == msg;  }) < 1){ 
                this.messages.push({'text':msg,'msgType':(msgType || '')});
            }
            this.show = true;
        },
        setPanel: function(panelType){
            this.panelType = panelType;
        },
        closeFeedback: function(){
            this.show = false;
            this.setPanel('');
            for (var i = 0; i <= (this.messages).length; i++) {
                this.messages.pop();
            };
            this.messages.pop();
        }
    }
}); 


//if partner isset, display welcome message


 
</script>
<script>

$(document).on('csvImportStarting.ck',function(e,data){
    ck.notifyUser.closeFeedback();
    $('body').removeClass('loadingCsv').addClass('processingCsv');
    $('#totalCardCount').text(data.totalCount);
});

$(document).on('click','.csvAddToCart',function(e){
    ck.notifyUser.closeFeedback();
    ck.importBuyList.addItemToCart( $(this).data('itemid') );
    $(this).addClass('inCart');
});

$(document).on('click','.result .inCart.csvAddToCart',function(e){
    ck.notifyUser.closeFeedback();
    ck.importBuyList.removeItemToCart( $(this).data('itemid') );
    $(this).removeClass('inCart');
});

$(document).on('click','.addAllToCart',function(e){
    //console.log('click index:'+ $(this).data('index'));
    ck.notifyUser.closeFeedback();
    ck.importBuyList.addAllToCart(e.target);
    $('.resultsPanel > li.result .csvAddToCart').addClass('inCart');
});

$(document).on('click','.toggleResultsHeight',function(e){
    $(this).parents('.resultsWrapper:not(.bulkWrapper)').toggleClass('expand');
}); 
/*
$(document).on('click','.csvRemoveInvalidItem',function(e){
    var confrimDelete = confirm("Deleting this item.");
    if (confrimDelete == true) {
        ck.notifyUser.closeFeedback();
        ck.importBuyList.deleteItemFromList( $(this).data('itemid') );
        $(this).parent().remove();
        $('body').removeClass('editInProgress');
    }   
});
*/
$(document).on('click','.csvResetInvalidItem',function(e){
    ck.csvImport.renderResults(ck.csvImport.items);  
    $('body').removeClass('editInProgress');
    $(document).off('click','.saveEditedCard'); 
});

$(document).on('click','.clearAndReset',function(e){
    //call clear via ajax, wait until  response, reload page
    $('#transferingToCartWrapper').addClass('active');
    $.ajax({url: "/sellcart/empty_cart", success: function(result){
        location.reload();
    }});

}); 


ck.csvImport.getItem = function(id) {
    for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {
        if ( (ck.csvImport.items[i])[ck.csvImport.itemFieldNames.id] ==  id ) { return ck.csvImport.items[i]; }
    };
}

ck.csvImport.getStoreItem = function(item,storeId) {
    //console.log('getStoreItem() item: ', item );
    var _hits = item[ck.csvImport.itemFieldNames.hits];
  for (var i = 0; i < _hits.length; i++) {
      if( (_hits[i]).index == storeId ){
        return _hits[i];
      }
  } 
}

ck.csvImport.sellSelectedQty = function(item,storeId,qty){
    var qty = parseInt(qty);
    var _totalQty = parseInt(item[ck.csvImport.itemFieldNames.qty]);
    var _remainder = _totalQty - qty;
    if(_remainder === 0){
        item[ck.csvImport.itemFieldNames.hits] = [ck.csvImport.getStoreItem(item,storeId)];
    } else {
        // clone original, generate new id, update qty, set to specificed storeId
        var _newItem =_.clone(item);
        _newItem[ck.csvImport.itemFieldNames.id] =_newItem[ck.csvImport.itemFieldNames.id] + '-' + storeId;
        _newItem[ck.csvImport.itemFieldNames.qty] = qty;
        _newItem[ck.csvImport.itemFieldNames.hits] = [ck.csvImport.getStoreItem(_newItem,storeId)];  //clean up hits with selected, removing all other hits 
        item[ck.csvImport.itemFieldNames.qty] = _remainder;     // update old qty with remainer    
        ck.csvImport.items.push(_newItem);                     //add new split item,and re-render
    }   
    ck.csvImport.renderResults(ck.csvImport.items);     
};

ck.csvImport.selectQty = function(target){
    var $parent = $(target).parents('.result');
    var _userItemId = $(target).parents('.multiHitItem').data('itemid');
    var _item;
    $target = $(target);
    if( ! $target.hasClass('thumb') ){ $target = $target.parent(); }
    _item = ck.csvImport.getItem(_userItemId);
    var _qtyPopup = '<ul class="qtySelectList"><li class="label"># with this artwork</li><li class="all">ALL</li>';
    var _qty = parseInt(_item[ck.csvImport.itemFieldNames.qty]);
    for (var i = 1; i <= _qty; i++) {
        _qtyPopup = _qtyPopup + '<li>' + i + '</li>';
    };
    _qtyPopup = _qtyPopup + '</ul>'
    $target.append(_qtyPopup);
    $target.find('.qtySelectList li').click(function(e){
        $target.find('.qtySelectList li').off('click');
        var _selectedQty =( $(e.target).text() );
        if(_selectedQty == 'ALL') { _selectedQty = _qty;}      
        _selectedQty = parseInt(_selectedQty);
        var _ckItemIndex = $(e.target).parent().parent().data('index'); 
         ck.csvImport.sellSelectedQty(_item,_ckItemIndex,_selectedQty);//_ckItemIndex
    });
};

$(document).on('click','.multiHitsString .thumb:not(.zoom)',function(e){
    //console.log('clickl:', e.target);
    $(e.target).parents('.resultsPanel').addClass('showZoomedItems');
    if ($(e.target).hasClass('multiResultsThumb')) {  
        $(e.target).parent().addClass('zoom');
        ck.csvImport.selectQty(e.target);
    } else {
        $(e.target).addClass('zoom');
        ck.csvImport.selectQty(e.target);
    }
    ck.importBuyList.multiHitsZoom = 1;
    
 });

 $(document).on('click',function(e){
    if( ck.importBuyList.multiHitsZoom !== 1 && ! $(e.target).hasClass('multiResultsThumb') ){
        $('.multiHitsString .thumb').removeClass('zoom').parents('.resultsPanel').removeClass('showZoomedItems').find('.qtySelectList').remove();
    }
    ck.importBuyList.multiHitsZoom = 0;
 });
 $(document).on('click','.multiHitsString .thumb.zoom > .multiResultsThumb',function(e){
    $(e.target).parent().removeClass('zoom').parents('.resultsPanel').removeClass('showZoomedItems').find('.qtySelectList').remove();  
 });


</script>
<script>
/*load json web worker interface*/
//enclose all related code, by passing in and returning ck
//public interface will be attached to ck.importBuyList
var ck = (function ($,_public) {
    var _private = {};
    var _public = _public || {}; //public interface should attach to this 
    var _worker;
    var _preProcessors = []; //list of objects including priority and function to pass and return modified data

    _private.updateSubcartUi = function(){ 
        var _subTotal=0, _subTotalCount=0, _catalogItem, _itemQty,_bulkType,_inCartBulkList={},_lineCount=0,_price;
        for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {
                
            if ( ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.inCart] === true ) {
                _catalogItem = ((ck.csvImport.items[i])[ck.csvImport.itemFieldNames.hits])[0];
                _itemQty=parseInt( (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.qty]) );
                _bulkType = (ck.csvImport.items[i])[ck.csvImport.itemFieldNames.bulkType];
                if(typeof _bulkType === 'object'){
                    _inCartBulkList[_bulkType.type] = _bulkType.price;
                    _subTotal = ck.roundMoneyUp(Number(_subTotal) + (Number(_bulkType.price) * _itemQty) );
                }else{
                    _price = parseFloat( _catalogItem.price.replace(/\,/g,'') ) ;
                    _subTotal = ck.roundMoneyUp(Number(_subTotal) + (Number(_price) * _itemQty) );
                    _lineCount++;
                }
                _subTotalCount = _subTotalCount + _itemQty;     
            }
        };
        _lineCount = _lineCount + _.keys(_inCartBulkList).length;
        $('#csvCartQty').text(_subTotalCount);
        $('#csvCartLineQty').text(_lineCount);
        $('#csvCartAmount').text(_subTotal);
        if( _subTotalCount > 0 ){
            $('.csvImportCart').addClass('ready');
        } else {
            $('.csvImportCart').removeClass('ready');
        }
        $('.csvImportCart').css({top:( window.scrollY+100 )});
        setTimeout(function(){ $('.csvImportCart.ready').css({top:( 100 )});  },3000);

    };

    _private.sendToCKCart = function(e){
        if( (ck.csvImport.items).length > 50 ){ $('#transferingToCartWrapper').addClass('isLarge'); }
        $('#transferingToCartWrapper').addClass('active');
        var _catalogItem, _qty,_id;
        var _item, _contents = [],_contentWrapper={},_bulkType;
        var _bulkList = _.clone(ck.csvImport.bulkTypes);
        for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {
            _item = (ck.csvImport.items)[i];
            if ( _item[ck.csvImport.itemFieldNames.inCart] === true && parseInt(_item[ck.csvImport.itemFieldNames.qty]) > 0 ) {
                _catalogItem = (_item[ck.csvImport.itemFieldNames.hits])[0];
                _bulkType = _item[ck.csvImport.itemFieldNames.bulkType];
                if(typeof _bulkType === 'object') {
                    _bulkType = _bulkType.type;
                    (_bulkList[_bulkType]).qty = (_bulkList[_bulkType]).qty + parseInt(_item[ck.csvImport.itemFieldNames.qty]);
                } else {
                    _id = _catalogItem.index;
                    _qty=parseInt( (_item[ck.csvImport.itemFieldNames.qty]) );
                    _contents.push({"id":_id,"qty":_qty});
                }              
            }
        };
        for (bulkItem in _bulkList) {
            if((_bulkList[bulkItem]).qty > 0){
                _contents.push({"id":(_bulkList[bulkItem]).index,"qty":(_bulkList[bulkItem]).qty});
            }
        };
        _contentWrapper.contents = _contents;
        //populate hidden form, and submit
        $('#finalCartContents').val( JSON.stringify(_contentWrapper) );
        $('#addToCartJsonForm').submit();        
    }

    _public.makeSafeForCSS = function(name) {
        return (name.trim()).replace(/[^a-z0-9]/g, function(s) {
            var c = s.charCodeAt(0);
            if (c == 32) return '';
            if (c >= 65 && c <= 90) return '' + s.toLowerCase();
            return '__' + ('000' + c.toString(16)).slice(-4);
        });
    }
    _public.addItemToCart = function(id){ 
        var _bulkQtys = {};
        var _lineCount = parseInt($('#csvCartLineQty').text());
        var _subTotalCount = parseInt($('#csvCartQty').text());
        var _thisItem =_.find(ck.csvImport.items,function(item){
            return item[ck.csvImport.itemFieldNames.id] == id ;
        });
        var _wrapperType = '';
        var _errorType = '';     
        if( typeof _thisItem[ck.csvImport.itemFieldNames.bulkType]  === 'undefined' ) {
            _lineCount++; 
            _subTotalCount = _subTotalCount + parseInt( _thisItem[ck.csvImport.itemFieldNames.qty] );
        } else {
            _wrapperType = _thisItem[ck.csvImport.itemFieldNames.bulkType].type;
            for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {  
                if((( typeof ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType] === 'object' ) && ( _wrapperType === (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType]).type  ) ) &&( id === (ck.csvImport.items[i])[ck.csvImport.itemFieldNames.id] ) ){
                     _subTotalCount = _subTotalCount + parseInt( ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.qty] );
                     if(typeof _bulkQtys[_wrapperType] === 'undefined') {
                        _bulkQtys[_wrapperType] = 1;
                     } 
                }
            }

        }
        _lineCount = _lineCount + ((_.keys(_bulkQtys)).length || 0);
         if(_lineCount > ck.csvImport.maxLineItems || _subTotalCount > ck.csvImport.maxCardCount){
            _errorType = 'Can not add selected items.  '
            if(_lineCount > ck.csvImport.maxLineItems){  _errorType = _errorType + 'Exceeds MAX LINE COUNT of '+ck.csvImport.maxLineItems+ '. No cards were added.'; }
            if(_subTotalCount > ck.csvImport.maxCardCount){  _errorType = _errorType + 'Exceeds MAX CARD COUNT of '+ck.csvImport.maxCardCount +'. No cards were added.'; }
            ck.notifyUser.addMsg(_errorType);
        } else {
            _thisItem[ck.csvImport.itemFieldNames.inCart] = true;
            _private.updateSubcartUi();
        }


    };
    _public.removeItemToCart= function(id){ 
        var _thisItem =_.find(ck.csvImport.items,function(item){
            return item[ck.csvImport.itemFieldNames.id] == id ;
        }) ;
        _thisItem[ck.csvImport.itemFieldNames.inCart] = false;
        _private.updateSubcartUi();
    };
    _private.checkHardLimits = function(){

    };
    _private.isABU600 = function(item){
        return false; //disabling ABU600

        var _hits = (item[(ck.csvImport.itemFieldNames.hits)])[0];
        if( typeof _hits === 'object'){
            var _price = parseFloat( _hits.price.replace(',','') ) ;   //_price = parseFloat((_hits[0].price).replace(',','')); 
            var _edition = (item[(ck.csvImport.itemFieldNames.edition)]).toLocaleLowerCase();

            if (_price > 600 && ( _edition=='alpha' || _edition=='beta' || _edition =='unlimited') ) {
                //console.log('IS ABU:',item);
                return true;
            }else{
                //console.log('NOT ABU:',item);
                return false;
            } 
        } else { return false; }
        
            

    };
    _public.addAllToCart = function(target){ 
        var _wrapperType = $(target).parents('.resultsPanel').attr('id');
        var _wrapperSelector = '#'+ _wrapperType;
        var _bulkQtys = {};
        var _lineCount = parseInt($('#csvCartLineQty').text());
        var _subTotalCount = parseInt($('#csvCartQty').text());
        var _errorType;
        //CHECK FOR HARD CAPS
        if(_wrapperType == "singleResults") {
            for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {  
                if( typeof ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType] === 'undefined' 
                && (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.hits]).length === 1
                && _private.isABU600((ck.csvImport.items)[i]) === false
                 ){
                    _lineCount++; 
                    _subTotalCount = _subTotalCount + parseInt( ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.qty] );
                }
            }
        } else { //bulk results
            for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {  
                if((( typeof ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType] === 'object' ) && ( _wrapperSelector === (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType]).selector  ) )){
                     _subTotalCount = _subTotalCount + parseInt( ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.qty] );
                     if(typeof _bulkQtys[_wrapperType] === 'undefined') { _bulkQtys[_wrapperType] = 1; } 
                }
            }

        }
        _lineCount = _lineCount + ((_.keys(_bulkQtys)).length || 0);        
        _errorType = '';
        if(_lineCount > ck.csvImport.maxLineItems || _subTotalCount > ck.csvImport.maxCardCount){
            if(_lineCount > ck.csvImport.maxLineItems){  _errorType = _errorType + 'Exceeds MAX LINE COUNT of '+ck.csvImport.maxLineItems+'.  '; }
            if(_subTotalCount > ck.csvImport.maxCardCount){  _errorType = _errorType + 'Exceeds MAX CARD COUNT of '+ck.csvImport.maxCardCount; }
            ck.notifyUser.addMsg(_errorType);
        } else {
            //identify cards in selected wrapper, and add flag that they are in cart
            for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {  
                if((_wrapperSelector === '#singleResults'
                    && _private.isABU600((ck.csvImport.items)[i]) === false 
                    && typeof ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType] === 'undefined'  
                    && (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.hits]).length === 1) 
                    || (( typeof ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType] === 'object' ) && ( _wrapperSelector === (((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.bulkType]).selector  ) )){
                    ((ck.csvImport.items)[i])[ck.csvImport.itemFieldNames.inCart] = true; 
                } 
            }
            $(_wrapperSelector).find('.csvAddToCart').addClass('inCart');
             _private.updateSubcartUi();
        }


            
    };
    
    _private.preProcessData = function(items){  
        _preProcessors = _.sortBy(_preProcessors, ['priority']);        //sort _preProcessors by priority
        for (var p = 0; p < _preProcessors.length; p++) {
            for (var i = 0; i < items.length; i++) {
                 items[i] = (_preProcessors[p].func)(items[i]);         //execute each processor, and update item
             }; 
        };
        return items;
    };
    _public.registerPreProcessor = function(newProcess){
        _preProcessors.push(newProcess);  /* newProcess = {INT_PRIORITY,function} */
    };
    
    _public.processCsv = function(results) {
        ck.notifyUser.closeFeedback();
        
        if(typeof results !== 'object'){
            var results = {};
            results.data = _.cloneDeep(ck.importBuyList.rawCsv); 
        } else {
            ck.importBuyList.rawCsv = _.cloneDeep(results.data); 
        }
       //strip header
       var _firstRow = results.data[0];
       var _hasHeader = _.findIndex(_firstRow, function(o) { 
                for (var _col in _firstRow){
                if( typeof _firstRow[_col] == 'string' && (_firstRow[_col]).length > 0 && ((_firstRow[_col]).trim()).toLowerCase() == 'edition') {
                    (results.data).splice(0, 1); 
                    return true; 
                }
            }
        });

       //strip empty items
       for (var i = (results.data).length - 1; i >= 0; i--) {
           if ( ((results.data)[i]).length < 2 ) {
            (results.data).splice(i, 1);
           }
       };

       results.data = _private.preProcessData(results.data);
       //remove any user items with qty of 0. note: items with qty undefined are already set to 1 by preProcessor
       for (var resultCount = (results.data).length - 1; resultCount >= 0; resultCount--) {
            if(results.data[resultCount][ck.csvImport.itemFieldNames.qty] < 1){
                (results.data).splice(resultCount, 1);
            }
       };

       var _totalCount = (results.data).length;
       var _completedCount = 0;

        if(ck.csvImport.buylistRdy == true) {  //if buylist ready, go for it
            $(document).trigger('csvImportStarting.ck',{'totalCount':_totalCount});
            _workerMatchMaker.postMessage({'cmd': 'userDataReady','items': JSON.stringify(results.data),'fieldNames': JSON.stringify(ck.csvImport.itemFieldNames) });//{'cmd': 'start', 'msg': msg}
            //console.log('B) processCsv data:',results.data);
        } else {  //else wait until buylistRdy
            //console.log('C) processCsv data:',results.data);
            $(document).on('buylistRdy.ck',function(){
                    $(document).trigger('csvImportStarting.ck',{'totalCount':_totalCount});
                    _workerMatchMaker.postMessage({'cmd': 'userDataReady','items': JSON.stringify(results.data),'fieldNames': JSON.stringify(ck.csvImport.itemFieldNames) });
            });
        }
       
    };

    _private.buildAddAllButtons = function(){
      var cardTotals = {};
       cardTotals.totalSinglesQty = 0; 
       cardTotals.totalSinglesValue = 0;
       cardTotals.totalBulkQty = 0; 
       cardTotals.totalBulkValue = 0;
               $('.singlesWrapper.hasResults .resultsPanel').each(function( index, el ){
            var $dQtyTotal = $(el).find('.dQtyTotal');
            var $dPriceTotal = $(el).find('.dPriceTotal');
            var _totalQty=0, _totalPrice=0, _thisQty, _thisPrice; //.dPriceTotal  .dQtyTotal
            if( $dQtyTotal.length === 1 && $dPriceTotal.length === 1 ){
                $(el).find('.dQty').each(function(qI,qEl){
                    _thisQty = parseInt($(qEl).text());
                    if(!isNaN(_thisQty)){ _totalQty =_totalQty + _thisQty; }
                });
                if($(el).attr('id') == 'singleResults'){
                    cardTotals.totalSinglesQty = cardTotals.totalSinglesQty + _totalQty;
                }else if( $(el).attr('id').indexOf('bulk') === 0){
                    cardTotals.totalBulkQty = cardTotals.totalBulkQty + _totalQty;
                }
                
            }
            if( $dPriceTotal.length === 1 ){
                $(el).find('.dTotal').each(function(qI,qEl){
                    _thisPrice = $(qEl).text();
                    _thisPrice = parseFloat(_thisPrice.replace('$',''));
                    if(!isNaN(_thisPrice)){ _totalPrice =_totalPrice + _thisPrice; }
                });
                if($(el).attr('id') == 'singleResults'){
                    cardTotals.totalSinglesValue = cardTotals.totalSinglesValue + _totalPrice;
                }else if( $(el).attr('id').indexOf('bulk') === 0){
                    cardTotals.totalBulkValue = cardTotals.totalBulkValue + _totalPrice;
                }
            }

        });
        //build add all to cart buttons
        cardTotals.totalSinglesValue = ck.roundMoneyUp(cardTotals.totalSinglesValue);
        cardTotals.totalBulkValue = ck.roundMoneyUp(cardTotals.totalBulkValue);

        var _singlesButton = _.template('<div class="addAllToCartWrapper"><div class="addAllSinglesToCart btn btn-success">Add all cards being purchased individually<br><span>(Total Cards:{{count}} Total Value:${{value}})</span></div></div>');
                 var _totalTitles = $('.result').length;
         if(cardTotals.totalSinglesQty < ck.csvImport.maxCardCount && _totalTitles < ck.csvImport.maxLineItems ){
            $('#csvProcessingResults').append((_singlesButton({'count':cardTotals.totalSinglesQty,'value':cardTotals.totalSinglesValue}) ));
            $(document).on('click','.addAllSinglesToCart',function(){
                $('.singlesWrapper.hasResults .addAllToCart').click();
            });

         } else {
            if( $('#csvProcessingResults .overMaxCards').length < 1 ) {
                $('#csvProcessingResults').append('<li class="resultsWarning overMaxCards">This tool currently has a maximum buy-limit of '+ ck.csvImport.maxLineItems +' titles, or '+ ck.csvImport.maxCardCount +' total cards. If you are interested in selling cards to Card Kingdom, you will need to select which cards to sell below.</li>');
            }
            
         }
          
        /*
        $(document).on('click','.addAllBulkToCart',function(buttonEl){
            $('.hasResults .resultsPanel').each(function(index,el){ 
                if( ($(el).attr('id')).indexOf('bulk') === 0 ) {  
                    $(el).find('.addAllToCart').click();
                }
            });
        });
        */
    };

    //on adding new item, look for wrapper with edition as class, withing proper result wrapper.
    //if: finds, append, else: add edition wrapper to start
    $(document).on('allResultsComplete',function(){
        var _resultsHeader = '<li class="csvResultsHeader"><span class="dThumbnail">&nbsp;</span><span class="dName">Card</span><span class="dQty">Qty(<span class="dQtyTotal"></span>)</span><span class="dPrice">Sell Price</span><span class="dTotal">Total(<span class="dPriceTotal"></span>)</span><span class="dCart"><span class="addAllToCart btn btn-subtle"><span class="addAllToCartIcon glyphicon glyphicon-shopping-cart"></span><span class="text">All</span></span></span></li>';
        var _bulkResultsHeader = '<li class="csvResultsHeader"><span class="dThumbnail">&nbsp;</span><span class="dName">Card</span><span class="dQty">Qty</span></li>';
        
        if( $('#singleResults .csvResultsHeader').length < 1 ){
            
            $('#singleResults').prepend(_resultsHeader);
        }

        $('.bulkWrapper .resultsPanel').prepend(_bulkResultsHeader);
        
        $('#csvProcessingResults > div:last-child').css({'display':'none'});
        if($('#multiResults > li').length > 0) {
            if( $('#multiResults .csvResultsHeader').length < 1 ){
                $('#multiResults').prepend( '<li class="csvResultsHeader"><span>Matches</span><span class="dName">Card</span><span class="dQty">Qty</span></li>' );
            }
            if( $('.multiResultWarning').length < 1 ){
                $('#csvProcessingResults').append('<li class="resultsWarning multiResultWarning">'+ $('#multiResults > li.multiHitItem').length +' card with more than one match. Please review and update to include these cards.</li>');
            } else {
                $('.multiResultWarning').text( ($('#multiResults > li.multiHitItem').length +' card with more than one match. Please review and update to include these cards.') );
            }
             $('#multiResults').parent().css({'display':'block'});
        } else { $('#multiResults').parent().css({'display':'none'}); } 
 
        if($('#noResults > li').length > 0) {
            if( $('#noResults .csvResultsHeader').length < 1 ){
                _resultsHeader = '<li class="csvResultsHeader"><span class="dCart"></span><span class="dName">Card Title</span><span class="dSet">Edition/Set</span><span class="dFoil">isFoil</span><span class="dQty">Qty</span></li>';
                $('#noResults').prepend(_resultsHeader);
            }
            if( $('.noResultWarning').length < 1 ){
                $('#csvProcessingResults').append('<li class="resultsWarning noResultWarning">'+ $('#noResults > .result').length +' cards that were not identfied. Please review and update to include these cards.</li>');
            } else {
                $('#noResultWarning').text((''+ $('#noResults > .result').length +' cards were not identfied. Please review and update to include these cards.'));
            }

        } else { $('#noResults').parent().css({'display':'none'}); }

        $('.hasResults .resultsPanel').each(function( index, el ){
            var $dQtyTotal = $(el).find('.dQtyTotal');
            var $dPriceTotal = $(el).find('.dPriceTotal');
            var _totalQty=0, _totalPrice=0, _thisQty, _thisPrice; //.dPriceTotal  .dQtyTotal
            if( $dQtyTotal.length === 1 && $dPriceTotal.length === 1 ){
                $(el).find('.dQty').each(function(qI,qEl){
                    _thisQty = parseInt($(qEl).text());
                    if(!isNaN(_thisQty)){ _totalQty =_totalQty + _thisQty; }
                });
                $dQtyTotal.text(_totalQty);  
            }
            if( $dPriceTotal.length === 1 ){
                $(el).find('.dTotal').each(function(qI,qEl){
                    _thisPrice = $(qEl).text();
                    _thisPrice = parseFloat(_thisPrice.replace('$',''));
                    if(!isNaN(_thisPrice)){ _totalPrice =_totalPrice + _thisPrice; }
                });
                $dPriceTotal.text( '$'+ck.roundMoneyUp(_totalPrice) );
            }

        });

        //show/hide wrappers is not empty
        if( $('.bulkWrapper .hasResults').length > 0 ){ $('.bulkWrapper').addClass('activeWrapper'); }
        if( $('#unidentifiedCards .result').length > 0 ){ $('#unidentifiedCards').addClass('activeWrapper'); }

        _private.buildAddAllButtons();
        if(typeof ck.csvImport.source !== 'undefined' && (ck.csvImport.source).length >1 ) { 
            $('#addToCartJsonForm input[name=po_origin]').val(2);
            $('#addToCartJsonForm input[name=source]').val(ck.csvImport.source); 
        } //set source for external affiliate

        window.scrollTo(0, 0);
    });

    $(document).on('click','.checkoutButton',_private.sendToCKCart); 
    $(document).on('click','.viewCsvFaq',function(){ $('body').addClass('showFaq') });
    $(document).on('click','#csvImportFaq .close',function(){ $('body').removeClass('showFaq') });

  //dom rdy init 
  $(function(){
    if ( /^((?!chrome|android).)*safari/i.test(navigator.userAgent)) { $('body').addClass('safari'); }
    
    _workerMatchMaker = new Worker( ('/media/js/csvparse/ww_matchmaker.js?v=' + ck.version) );
    _workerBuyList = new Worker( ('/media/js/csvparse/ww_loadBuylist.js?v=' + ck.version) );

    /* load setlist */
    $.ajax("/assets/json/setlist.jsonp",{ dataType: "jsonp" });
    ckSetList = function(sets) { 
        ck.setList = [];
        var _setName, _setTla, _set;
        for (var setIndex = sets.length - 1; setIndex >= 0; setIndex--) {
            _setName = (Object.keys(sets[setIndex])[0]).toLowerCase(); 
            _setTla = (Object.values(sets[setIndex])[0]).toLowerCase();
            _set = {'name' : _setName, 'tla':_setTla};
            ck.setList.push(_set);
        }
    };    

    var setBulkType = function(item){
        var card = (item[(ck.csvImport.itemFieldNames.hits)])[0];
        var _rarity,_title;
        if(typeof card === 'object'){
            _rarity = (card.rarity).toLowerCase();
            _title = (card.name).toLowerCase();
              //edition, foil, imageurl, index, name, price, qty, rarity
            if( _rarity == 'm' && card.foil == 'false'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.mythics);
            } else if( _rarity == 'r' && card.foil == 'false'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.rares);
            } else if( (_rarity == 'c' || _rarity == 'u') && card.foil == 'false'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.commonsUncommons);
            } else if( _title == 'forest' || _title == 'island' || _title == 'mountain' ||_title == 'plains' || _title == 'swamp' ){ // _rarity == 'L' && card.foil == 'false' // should FOIL BASIC LANDS GO HERE?
                if(card.foil !== 'false'){
                    _bulkType = _.clone(ck.csvImport.bulkTypes.foilBasicLands);
                } else {
                    _bulkType = _.clone(ck.csvImport.bulkTypes.basicLands);  
                }
            } else if( _rarity == 'm' && card.foil == 'true'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.foilMythics);            
            } else if( _rarity == 'r' && card.foil == 'true'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.foilRare);
            } else if( (_rarity == 'c' || _rarity == 'u') && card.foil == 'true'){
                _bulkType = _.clone(ck.csvImport.bulkTypes.foilCommonsUncommons);
            } else if( (card.edition).toLowerCase() == 'promotional' ){
                _bulkType = _.clone(ck.csvImport.bulkTypes.promos);
            } else if( _rarity == 's'){
                if( _title.indexOf('token') > -1 ){
                    _bulkType = _.clone(ck.csvImport.bulkTypes.tokens); 
                } else {
                   _bulkType = _.clone(ck.csvImport.bulkTypes.promos); 
                }
                
            } else {                
                if( _title.indexOf('token') > -1 ){
                    _bulkType = _.clone(ck.csvImport.bulkTypes.tokens); 
                } else {
                   _bulkType = _.clone(ck.csvImport.bulkTypes.commonsUncommons);
                }
            }
            item[(ck.csvImport.itemFieldNames.bulkType)] = _bulkType;
        }
        return item;
    };
     var renderItem = function(item) {
        var _hits = item[(ck.csvImport.itemFieldNames.hits)];
        var _price, _edition;// = _hits[0].price;
        var _foil = (item[(ck.csvImport.itemFieldNames.foil)]==1) ? ' <span class="foil">FOIL</span>' : '';
        var _qty = parseInt(item[(ck.csvImport.itemFieldNames.qty)]);
        var _total,_displayPrice;//(_qty > 1) ? ck.roundMoneyUp(_qty * _hits[0].price) : _hits[0].price;
        var _maxQty, _imageUrlSegments, _imageUrl,_encodedEdtionName,_inCart;
        var _selector;
        ck.bulkCKisBuyingCount = ck.bulkCKisBuyingCount || 0;
        ck.singlesCKisBuyingCount = ck.singlesCKisBuyingCount || 0;

        function decimalPlaces(num) {
          var match = (''+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);
          if (!match) { return 0; }
          return Math.max(
               0,(match[1] ? match[1].length : 0) );
        }

        if(typeof _hits == 'undefined') {
            console.log('error parsing:',item);
        } else if(_hits.length == 1) {  
            _maxQty = parseInt(_hits[0].qty || 0);
            _imageUrlSegments = (_hits[0].imageurl).split('/');
            _imageUrl = '/images/magic-the-gathering/'+ _imageUrlSegments[_imageUrlSegments.length-2] + '/' + _imageUrlSegments[_imageUrlSegments.length-1];
            _price = parseFloat((_hits[0].price).replace(',',''));  
            _edition = (item[(ck.csvImport.itemFieldNames.edition)]).toLocaleLowerCase();
            if( _private.isABU600(item)){
                _selector = '#specialValueResults';
            } else if(_maxQty === 0 || typeof item[(ck.csvImport.itemFieldNames.bulkType)] === 'object' ) {
               item = setBulkType(item);
               _selector = (item[(ck.csvImport.itemFieldNames.bulkType)]).selector;
               _price = (item[(ck.csvImport.itemFieldNames.bulkType)]).price; 
               ck.bulkCKisBuyingCount = ck.bulkCKisBuyingCount + parseInt(item[ck.csvImport.itemFieldNames.qty]); 
            } else if(_maxQty >= _qty){
                _selector = '#singleResults'; //_selector is default in dev  
                ck.singlesCKisBuyingCount = ck.singlesCKisBuyingCount + parseInt(item[ck.csvImport.itemFieldNames.qty]);   
            } else if(_maxQty < _qty){
               /* moved to splitItems pre-render    */
                
            }else {
                console.log('unknown render type. _qty:'+ _qty +', _maxQty:'+ _maxQty);
            }

            _total = (_qty * _price);
            _total = (decimalPlaces(_total) < 2) ? ck.roundMoneyUp(_total) : _total.toFixed(2);
            _displayPrice = '$' + ( (_price > .01) ? ck.roundMoneyUp(_price) : _price );
    
            _encodedEdtionName = _public.makeSafeForCSS( item[(ck.csvImport.itemFieldNames.edition)] );
            _inCart = (item[ck.csvImport.itemFieldNames.inCart] === true) ? 'inCart' : ''
            
            $(_selector).parent().addClass('hasResults');

            var $editionWrapper = $(( _selector +   ' .'+_encodedEdtionName));
            //if edition does not exist, add
            if( $editionWrapper.length < 1 ) {
                  $editionWrapper = $('<div class="editionWrapper '+_encodedEdtionName+'" data-set="'+_encodedEdtionName+'"></div>');
                  $(_selector).append($editionWrapper);
            } 
            if($editionWrapper.find('.editionName').length === 0){ $editionWrapper.prepend(('<li class="editionName">'+ item[(ck.csvImport.itemFieldNames.edition)]  + '</li>')); }

                        if(typeof item[ck.csvImport.itemFieldNames.bulkType] === 'undefined'){
                $editionWrapper.append('<li class="result"><span class="dThumbnail glyphicon glyphicon-search" data-imgurl="'+ _imageUrl +'"></span><span class="dName">' + item[(ck.csvImport.itemFieldNames.name)] + ' ('+_hits[0].rarity+')'+_foil+'</span><span class="dQty">'+ _qty +'</span><span class="dPrice">'+ _displayPrice +'</span><span class="dTotal">$'+_total+'</span><span class="csvAddToCart glyphicon glyphicon-shopping-cart '+ _inCart +'" data-itemid="'+ item[(ck.csvImport.itemFieldNames.id)] +'"></span></li>');                
            }else{
                $editionWrapper.append('<li class="result"><span class="dThumbnail glyphicon glyphicon-search" data-imgurl="'+ _imageUrl +'"></span><span class="dName">' + item[(ck.csvImport.itemFieldNames.name)] + ' ('+_hits[0].rarity+')'+_foil+'</span><span class="dQty">'+ _qty +'</span></li>');                
            }
            /*
            if(_price > 600 && ( _edition=='alpha' || _edition=='beta' || _edition =='unlimited') ){
                $editionWrapper.find('.csvAddToCart').replaceWith('<span class="contactBuyer">contact buyer@cardkingdom.com</span>');
                $editionWrapper.find('.dPrice').html('');
                $editionWrapper.find('.dTotal').html('');
            } 
            */           
            processingFeedback();

        } else if(_hits.length > 1) {
          
            var _multiHitsString = '';
            if(_hits.length < 40) {
                for (var i = _hits.length - 1; i >= 0; i--) {
                    var _hitFoil = (_hits[i].foil == 'true') ? ' FOIL ' : '';
                    _imageUrlSegments = (_hits[i].imageurl).split('/');

                    _imageUrl = '//www.cardkingdom.com/images/magic-the-gathering/'+ _imageUrlSegments[_imageUrlSegments.length-2] + '/' + _imageUrlSegments[_imageUrlSegments.length-1];
                    _multiHitsString = _multiHitsString + '<div class="thumb" data-index="'+ _hits[i].index +'"><img class="multiResultsThumb" src="'+ _imageUrl +'""></div>';
                }; //timing issue below?
            } else {
                _multiHitsString = '<p>Error parsing title. ('+ _hits.length +' hits)</p>'
            }
            
            $('#multiResults').append('<li class="result multiHitItem" data-itemid="'+ item[(ck.csvImport.itemFieldNames.id)] +'"><span class="dCart">['+ _hits.length + ' matches]<br>Select Card:</span><span class="dName">' + item[(ck.csvImport.itemFieldNames.name)] + '<div class="multiHitsString">'+_multiHitsString+'</div></span><span class="dSet">'+  item[(ck.csvImport.itemFieldNames.edition)] + '</span><span class="dFoil">'+ _foil +'</span><span class="dQty">'+ _qty +'</span><span class="dPrice"></span><span class="dTotal"></span></li>');
        } else {
            $('#noResults').append('<li class="result" data-itemid="'+ item[(ck.csvImport.itemFieldNames.id)] +'"><span class="csvEditInvalidItem glyphicon glyphicon-pencil" data-itemid="'+ item[(ck.csvImport.itemFieldNames.id)] +'"></span><span class="csvResetInvalidItem glyphicon glyphicon-step-backward" data-itemid="'+ item[(ck.csvImport.itemFieldNames.id)] +'" title="Undo all changes"></span><span class="dName"><span class="editText">' + item[(ck.csvImport.itemFieldNames.name)] + '</span></span><span class="dSet"><span class="editEdition">'+ item[(ck.csvImport.itemFieldNames.edition)]  + '</span></span><span class="dFoil">' + _foil +'</span><span class="dQty"><span class="dQtyValue">'+ _qty +'</span></span></li>');
        }   
    };

    $(document).on('click','.result > .dThumbnail',function(e){
        if( $(e.target).hasClass('showImage') ) {
            $('.dThumbnail').removeClass('showImage').find('img').remove();
        } else {
            $(e.target).addClass('showImage').append('<img class="showImage" src="'+ $(e.target).data('imgurl') +'">');
        }
    });

    var processingFeedback = function(data){
        $('#singlesCKisBuyingCount').text(ck.singlesCKisBuyingCount);
        $('#bulkCKisBuyingCount').text(ck.bulkCKisBuyingCount);
        if(data){
            $('#cardsProcessedCount').text(data.cardsProcessedCount);
            $('#lastCardIdentified').text( data.lastCard[ck.csvImport.itemFieldNames.name]);
        }

    };

    var mergeItems = function(items){
        var _primary, _secondary,_newQty;
        for (var p = items.length - 1; p >= 0; p--) {
            _primary = items[p];
            //console.log('item:',_primary);
            if( typeof _primary !== 'undefined' && (_primary[ck.csvImport.itemFieldNames.hits]).length == 1){                
                _primaryHit =(_primary[ck.csvImport.itemFieldNames.hits])[0];
                for (var s = items.length - 1; s >= 0; s--) {
                    if(p !== s){
                        _secondary = items[s];
                        if( typeof _secondary !== 'undefined' && (_secondary[ck.csvImport.itemFieldNames.hits]).length == 1){
                            _secondaryHit =(_secondary[ck.csvImport.itemFieldNames.hits])[0];
                            if(_primaryHit.index === _secondaryHit.index ){
                                _newQty = parseInt(_primary[ck.csvImport.itemFieldNames.qty]) + parseInt(_secondary[ck.csvImport.itemFieldNames.qty]);
                                (items[p])[ck.csvImport.itemFieldNames.qty] = _newQty;
                                items[s] = undefined;
                            }

                        }
                    }
                    
                };
                
            }
        };
        return items;
    };

    var splitItems = function(items){
        var item,_hits,_qty,_maxQty,_dupeNoticeCheck;
        for (var i = items.length - 1; i >= 0; i--) {
            item = items[i];
            if(typeof item !== 'undefined') {
                _hits = item[(ck.csvImport.itemFieldNames.hits)];
                _qty = parseInt(item[(ck.csvImport.itemFieldNames.qty)]);
                if(_hits.length == 1) {  
                    _maxQty = parseInt(_hits[0].qty || 0);
                    if(_maxQty > 0 && _maxQty < _qty){
                        var _remainderForBulk = _qty - _maxQty;
                        var _originalQty = _qty;
                        _qty = _maxQty;
                        item[(ck.csvImport.itemFieldNames.qty)] = _qty;
                        var _newItem = _.clone(item);
                        _newItem[(ck.csvImport.itemFieldNames.qty)] = _remainderForBulk;
                        _newItem[(ck.csvImport.itemFieldNames.id)] = 'bulk-'+ _newItem[(ck.csvImport.itemFieldNames.id)];
                        _newItem = setBulkType(_newItem);
                        items.push(_newItem);
                        ck.csvImport.dupeNotificationFilter = ck.csvImport.dupeNotificationFilter || [];
                         _dupeNoticeCheck = false;
                        for (var d = 0; d < (ck.csvImport.dupeNotificationFilter).length; d++) {
                           if( ((ck.csvImport.dupeNotificationFilter)[d]).name === item[(ck.csvImport.itemFieldNames.name)] 
                            && ((ck.csvImport.dupeNotificationFilter)[d]).qty === _qty  ) {
                            _dupeNoticeCheck = true;
                            break;
                           }
                        };

                        if(_dupeNoticeCheck === false) {
                                                        ck.notifyUser.addMsg('You had more "'+ _newItem[(ck.csvImport.itemFieldNames.name)] +'/'+ _newItem[(ck.csvImport.itemFieldNames.edition)] +'" ('+_originalQty+') than we can buy at our full singles price ('+_maxQty+').' );
                            (ck.csvImport.dupeNotificationFilter).push({'name': item[(ck.csvImport.itemFieldNames.name)],'qty':_qty});
                        }

                        
                    }

                }
            }
                
        };
            
        return items;
    };


    var renderResults = ck.csvImport.renderResults = function(items) {
        new Promise(function(resolve, reject) {
            //reset bulkTypes and mergeItems
            //must clear out bulkTypes before re-rendering, to prevent merge from moving splits to all bulk
            for (var i = items.length - 1; i >= 0; i--) {
                if(typeof items[i] === 'object') {
                    (items[i])[ck.csvImport.itemFieldNames.bulkType] = undefined;
                }
            };
            resolve( mergeItems(items) );            
        }).then(function(items) {  
            //splitItems
            items = splitItems(items);
            //console.log('step 2 result:',items);
            return items; 
        }).then(function(items) {
            //remove empty lines    
            for (var i = items.length - 1; i >= 0; i--) {
                if(typeof items[i] === 'undefined'){ items.splice(i, 1); }
            };
            return items; 
        }).then(function(items) {
            //SORT BY EDITION/TITLE
            //swap out forced spaces for @ as placeholder for sorting
            for (var i = items.length - 1; i >= 0; i--) {
                if(typeof items[i] === 'object') {
                    (items[i])[ck.csvImport.itemFieldNames.edition] = ((items[i])[ck.csvImport.itemFieldNames.edition]).replace(' ','@').toLowerCase();
                }
            };
            items = _.sortBy(items,[ck.csvImport.itemFieldNames.edition,ck.csvImport.itemFieldNames.name]); 
            for (var i = items.length - 1; i >= 0; i--) {
                 if(typeof items[i] === 'object') {
                    (items[i])[ck.csvImport.itemFieldNames.edition] = (((items[i])[ck.csvImport.itemFieldNames.edition]).replace('@',' '));// .trim(); //KEEP the space for later sorting. trim in view
                }
            };

            return items; 
        
        }).then(function(items){
            ck.csvImport.items = items;
            ck.bulkCKisBuyingCount = ck.bulkCKisBuyingCount = 0;
            ck.singlesCKisBuyingCount = ck.singlesCKisBuyingCount = 0;
            $('.resultsPanel .editionWrapper').remove();
            $('.resultsPanel li').remove();
            //console.log('SORTED BY EDITION/TITLE:',items);
            for (var i = 0; i < items.length; i++) {
                 if(typeof items[i] === 'object') { renderItem(items[i]); }
            };
            $(document).trigger('allResultsComplete'); 

           
            
        });


    };



    var csvSetColumns = function(){     
        ck.csvImport.ColumnsInit = ck.csvImport.ColumnsInit || 0;
        ck.csvImport.ColumnsInit++; //if(ck.csvSetColumns.init > 1)      
        var items = ck.importBuyList.rawCsv;
        ck.csvImport.buylistRdy = false;
        ck.csvImport.fieldList = {'title':-1, 'edition': -1, 'foil': -1,'qty': -1}; 
        if (ck.csvImport.ColumnsInit > 1) {
            $('.reParseButton').removeClass('active');            
        };

        var buildSelectList = function(columnIndex){
            var _selectlist = '';
            for(var key in ck.csvImport.fieldList){
                if( ck.csvImport.fieldList[key]  < 0) {
                    _selectlist = _selectlist + '<li>'+ key +'</li>';
                }
            }
            _selectlist = '<ul class="ckSelect">'+ _selectlist +'<li>reset</li></ul>';
            return _selectlist;
        };
        var checkComplete = function(){
            var _readyToSubmit = true;
            for(var key in ck.csvImport.fieldList){
               if (ck.csvImport.fieldList[key] < 0) { _readyToSubmit = false; break;} 
            }
            return _readyToSubmit;
        };

        var buildHeader = function(){
            item = items[1];
            var _html = '<tr class="csvSetColumnHeader">';
            for (var ci = 0; ci < item.length; ci++) {
                _html = _html + '<td data-column="'+ ci +'" class="col'+ ci  +'"><div class="headerPlaceHolder">Set Column</div></td>';
            }
            _html = _html + '</tr>';

            return _html;
        };
        
        $('body').addClass('parseError');
        $('#csvSetColumns').html(''); //reset
        var item,_foil,_qty;
        var _html = buildHeader();
        if( $('.csvSetColumnHeader').length > 1 ){
            $('.csvSetColumnHeader').html(_html);
        } else {
            $('#csvSetColumns').append(_html);
        }
    
        var _itemLength = items.length;
        _itemLength = (_itemLength > 8) ? 8 : _itemLength;
        for (var i = 0; i < _itemLength; i++) {
            item = items[i];
            _html = '<tr class="itemRow">';
            for (var ci = 0; ci < item.length; ci++) {
                _html = _html + '<td data.column="'+ ci +'">' + item[ci] + '</td>';
            };
            _html = _html + '</tr>\n';
            $('#csvSetColumns').append(_html);
        };
        if(ck.csvImport.ColumnsInit === 1) {
            $(document).on('click','.headerPlaceHolder',function(e){
                $('.ckSelect').remove();
                var _isOpen = $(e.target).parent().hasClass('open');
                $('td').removeClass('open');
                if(_isOpen) {
                    $('.ckSelect').remove();
                } else {
                    var _cIndex = $(e.target).parent().data('column');
                    $(e.target).parent().append(buildSelectList(_cIndex));
                    $(e.target).parent().addClass('open');
                }
            });
            $(document).on('click','.ckSelect > li',function(e){
                var $itemEl = $(e.target).parents('td');
                var _val = ($(e.target).text()).toLowerCase();
                for(var key in ck.csvImport.fieldList){
                    if(ck.csvImport.fieldList[key] ==  $itemEl.data('column') ){ ck.csvImport.fieldList[key] = -1;break; }
                }
                if(_val == 'reset'){
                    $itemEl.find('.headerPlaceHolder').text('set column').removeClass('isset');
                    $itemEl.removeClass('open');
                    $('.reParseButton').removeClass('active');
                    $itemEl.find('.ckSelect').remove();
                } else {
                    if( ck.csvImport.fieldList[_val] > -1){
                        var _oldCol = ck.csvImport.fieldList[_val];
                        ck.csvImport.fieldList[_val] = -1; //clear old selection
                    }

                    $itemEl.find('.headerPlaceHolder').text(_val).addClass('isset');
                    ck.csvImport.fieldList[_val] = $itemEl.data('column');
                    $('.ckSelect').remove();
                    if( checkComplete() === true){ $('.reParseButton').addClass('active');  }
                }
                $itemEl.removeClass('open');
               
            });

            $(document).on('click','#setNoFoils',function(e){
                //run thru all items, adding new field, set to 0, set foil to point at new field
                for (var i = items.length - 1; i >= 0; i--) {                   
                    items[i].push(0);                    
                };
                ck.csvImport.fieldList.foil = items[0].length-1;
                $('.headerPlaceHolder').each(function(index,el){ 
                    if( $(el).text().toLowerCase() == 'foil' ){$(el).text('set column').removeClass('isset');}
                });
                $('.ckSelect').remove();
                if( checkComplete() === true){ $('.reParseButton').addClass('active');  }
                $(e.target).removeClass('btn btn-primary').addClass('btn-success').text('All cards set to no foil.');
            });
            $(document).on('click','#setQtyOne',function(e){
                //run thru all items, adding new field, set to 1, set qty to point at new field
                for (var i = items.length - 1; i >= 0; i--) {                   
                    items[i].push(1);
                };
                ck.csvImport.fieldList.qty = items[0].length-1;
                $('.headerPlaceHolder').each(function(index,el){ 
                    if( $(el).text().toLowerCase() == 'qty' ){$(el).text('set column').removeClass('isset');}
                });
                $('.ckSelect').remove();
                if( checkComplete() === true){ $('.reParseButton').addClass('active');  }
                $(e.target).removeClass('btn btn-primary').addClass('btn-success').text('All cards set to qty = 1.');
            });

            $(document).on('click','.reParseButton.active',function(){
                ck.notifyUser.closeFeedback();
                ck.csvImport.itemFieldNames.name = parseInt(ck.csvImport.fieldList['title'])+1;
                ck.csvImport.itemFieldNames.edition = parseInt(ck.csvImport.fieldList['edition'])+1;
                ck.csvImport.itemFieldNames.foil = parseInt(ck.csvImport.fieldList['foil'])+1;
                ck.csvImport.itemFieldNames.qty = parseInt(ck.csvImport.fieldList['qty'])+1;
                $('body').removeClass('parseError');
                ck.csvImport.buylistRdy = true;
                ck.importBuyList.processCsv();
                $('.ckSelect').remove();
                if( checkComplete() === true){ $('.reParseButton').addClass('active');  }
                
            });
            
        }
            
    };

      var _processWorkerMsg = function(data){
        switch (data.msgType) {
            case 'result':
               //$('#results').append( data.msg+"<br>");//build real data when you have an id

            break
          case 'dbReady':
            _workerMatchMaker.postMessage({'cmd': 'buyListReady','fieldNames':ck.csvImport.itemFieldNames}); 
            ck.csvImport.buylistRdy = true;
            $(document).trigger('buylistRdy.ck');


          break;
          case 'mmComplete':
            //final processing in a promise then render results
            renderResults( JSON.parse(data.items) );
            $('body').addClass('resultsAvailable');
          break;
          case 'log':
            //console.log('webworker log:',data.msg);
            break;
          case 'dir':
           //console.log( 'dir:');
            //console.dir( JSON.parse( data.msg ));
          break;
          case 'feedback':
                _public.notifyUser.addMsg(data.msg);
            break;
        case 'cardProcessed':
            processingFeedback(data.details);
        break;
        case 'deliverUniqueNames':
            ck.csvImport.uniqueNames = JSON.parse( data.names );
            $(document).trigger('uniqueNamesReady.ck');

        break;
        case 'deliverEditions':
            ck.csvImport.validEditions = JSON.parse( data.editions );
            $(document).trigger('validEditionsReady.ck');

        break
        case 'parseError':
            ck.notifyUser.addMsg('Unable to parse file data. If this is a CSV file, you should be able to set columns below. Please see the <span class="viewCsvFaq">CSV Import FAQ</span></a> for further information.','warning');
            csvSetColumns();
        break;

          default:
            //console.log('webworker unknown msg:',data);
        };


      };
      //direct messages from webworker
      _workerBuyList.addEventListener('message', function(e) {
        if ( typeof e.data.msgType !== 'undefined' ){
            _processWorkerMsg(e.data);
        } else {
            //console.log('unknown web worker msg:',e.data);
        }
  
      }, false);

      _workerMatchMaker.addEventListener('message', function(e) {
        _processWorkerMsg(e.data);  
      }, false);

    });
    
    /* Kicks off multi-step edit unknown item process.*/
    /* Currently all the code is encapsulated in this event function */
    $(document).on('click','body:not(.editInProgress) .csvEditInvalidItem',function(e){
        $this = $(e.target);
        $('body').addClass('editInProgress');
        var $parent = $(e.target).parent();
        $('.result.editing').removeClass('.editing');
        $parent.addClass('editing editingTitle');
        var $nameEl = $(e.target).siblings('.dName');
        var $editText = $nameEl.find('.editText');
        $editText.attr('contenteditable','true').removeClass('updated');
        var _nameList;
        var $aValidTitle;

        $(document).on('validEditionsReady.ck',function(){
            var _editionListHtml = '<ul class="setEdition"><li>Select Edition</li>';
            var _selected;
            var _editions=[];
            for (var i = 0; i < (ck.csvImport.validEditions).length; i++) {_editions.push( ((ck.csvImport.validEditions)[i]).edition );}
            _editions = _.uniq(_editions);
            _editions.sort();
            for (var i = 0; i < _editions.length; i++) {
                _selected='';
                if( _editions == $parent.find('.editEdition').text() ){_selected = 'selected';}
                 _editionListHtml = _editionListHtml + '<li class="setEditionItem '+ _selected +'">' + _editions[i] + '</li>';
            };
            _editionListHtml = _editionListHtml + '</ul>';
            $parent.find('.dSet').append(_editionListHtml); 
            if( _editions.length === 1 ){ $parent.find('.setEditionItem').click(); }
            $(document).off('validEditionsReady.ck');
        });
        var getEditionList = function(title){
            _workerMatchMaker.postMessage({'cmd': 'buildEditionList','title':title});
        };
        var $validEditText = $(e.target).parents('.result').find('.editing.editingTitle .editText');
       
        $(document).on('keyup focusin',$validEditText,function(editingEl){ //$editText shold not fire unless editing.editingTitle   
            var _input = $editText.text();
            var _validNames = [];
            if(_input.length > 2) {
                //filter ck.csvImport.uniqueNames for _validNames
                _validNames = _.filter(ck.csvImport.uniqueNames,function(item){
                    if( (item.toLowerCase() ).indexOf( (_input.toLowerCase()) ) === 0) return item; //only looking at front
                });
                _nameList ='<ul class="dNameList"><li>Pick Exact Card</li>';
                for (var i = 0; i < _validNames.length; i++) {
                    var _newline = '<li class="dNameOption">' + _validNames[i] + '</li>';
                    _nameList = _nameList + _newline;

                };
                _nameList = _nameList + '</ul>';
            }
            $nameEl.find('.dNameList').remove();
            if( $(editingEl.target).hasClass('editText') === true){$nameEl.append(_nameList);}
            if(typeof $aValidTitle == 'undefined') {
                $aValidTitle = $nameEl.find('.dNameList > li');
                $(document).on('click',$aValidTitle,function(e){
                    if( $(e.target).hasClass('dNameOption') ) {
                        $editText.text( $(e.target).text() );
                        $(e.target).parents('.editingTitle').removeClass('editingTitle');
                        $editText.attr('contenteditable','false').addClass('updated');
                        $(e.target).parent().remove();
                        getEditionList( $editText.text() );
                        $aValidTitle = undefined;
                    }
                });

            }
            

        });

        //on setEdition
         $(document).on('click','.setEditionItem',function(e){
            var _subset=[],_foilSubSet=[];
            var _isFoil = '';
            var _subsetelectHtml='';
            var _buyListRecord;
            //$editText.attr('contenteditable','false').addClass('updated');
            $(e.target).parent().siblings('.editEdition').text( $(e.target).text() );
            this.buildNoFoilChoice = function(){  
                _isFoil = (_subset.foil == 'true') ? 'FOIL' : '' ;
                if(_isFoil === 'FOIL') { $parent.find('.dFoil').html('<span class="foil">FOIL</span>'); 
                } else { $parent.find('.dFoil').html('');}
                $parent.find('.dQty').append('<span class="btn btn-success saveEditedCard" data-index="' + _subset.index + '">Submit</span>');
                _buyListRecord = _subset;
            };
            this.listenForFoilChoice = function(){
                $(document).on('click','.dFoilOption',function(eFoil){
                    var _buyListItem,_buyListIndex;
                    _buyListIndex = $(eFoil.target).data('index');
                    _buyListRecord = _.find(_subset,function(record){
                        if(record.index == _buyListIndex){ return record; }
                    });//get _subset with this index
                    _isFoil = ($(eFoil.target).text() == 'YES') ? 'FOIL' : '' ;

                    if(_isFoil === 'FOIL') { 
                        $parent.find('.dFoil').html('<span class="foil">FOIL</span>');
                    } else { 
                        $parent.find('.dFoil').html('');
                    }
                    $parent.find('.dQty').append('<span class="btn btn-success saveEditedCard" data-index="' + _subset[0].index + '">Submit</span>');  
                    $parent.find('.dFoilList').remove();
                    $(document).off('click','.dFoilOption');

                    for (var s = _subset.length - 1; s >= 0; s--) {
                        if(_isFoil === 'FOIL' && _subset[s].foil == 'true'){ _foilSubSet.push(_subset[s]); }
                        if(_isFoil !== 'FOIL' && _subset[s].foil !== 'true'){ _foilSubSet.push(_subset[s]); }
                    };
                    _subset = _foilSubSet;
                });
            };
            for (var i = (ck.csvImport.validEditions).length - 1; i >= 0; i--) {
                if (((ck.csvImport.validEditions)[i]).edition == $(e.target).text() ){ _subset.push( ((ck.csvImport.validEditions)[i]) ); }
            }

            if(_subset.length === 1) {
                this.buildNoFoilChoice(_subset[0]);
            } else if(_subset.length >= 2) { 
                 _subsetelectHtml = '';
                 var _txtFoil;
                 var foundFoilCard = false;
                 var foundStdCard = false;
                 for (var i = 0; i < _subset.length; i++) {
                    if (foundFoilCard == false && _subset[i].foil == 'true') {
                        _txtFoil = 'YES';
                        foundFoilCard = true;
                        _subsetelectHtml = _subsetelectHtml + '<li class="dFoilOption" data-index="'+ _subset[i].index +'">' +  _txtFoil + '</li>';
                    } else if(foundStdCard == false && _subset[i].foil !== 'true') {
                        _txtFoil = 'NO';
                        foundStdCard = true;
                        _subsetelectHtml = _subsetelectHtml + '<li class="dFoilOption" data-index="'+ _subset[i].index +'">' +  _txtFoil + '</li>';
                    }
                     
                 }
                 //if only one choice, pass to this.buildFoilUI(_subset[0]);
                 if( $( ('<ul>'+ _subsetelectHtml +'</ul>') ).find('li').length == 1  ){ 
                     this.buildNoFoilChoice(_subset[0]);
                 } else {
                    _subsetelectHtml = '<ul class="dFoilList"><li>Is this card a Foil?</li>' + _subsetelectHtml + '</ul>';
                    $parent.find('.dFoil').append(_subsetelectHtml);
                    this.listenForFoilChoice(_subset);
                 }
    
            } else { 
                _isFoil = (_subset[0].foil == 'true') ? 'FOIL' : '' ;
                if(_isFoil === 'FOIL') { $parent.find('.dFoil').html('<span class="foil">FOIL</span>'); 
                } else { $parent.find('.dFoil').html('');}
                $parent.find('.dQty').append('<span class="btn btn-success saveEditedCard" data-index="' + _subset[0].index + '">Submit</span>');
                for (var s = _subset.length - 1; s >= 0; s--) {
                    if(_isFoil === 'FOIL' && _subset[s].foil == 'true'){ _foilSubSet.push(_subset[s]); }
                    if(_isFoil !== 'FOIL' && _subset[s].foil !== 'true'){ _foilSubSet.push(_subset[s]); }
                };
                _subset = _foilSubSet;
            } 

            $(document).on('click','.saveEditedCard',function(evt){  
                var item = [];
                item[(ck.csvImport.itemFieldNames.id)] = $parent.data('itemid');
                item[(ck.csvImport.itemFieldNames.hits)] = _subset;//[_buyListRecord];
                item[(ck.csvImport.itemFieldNames.name)] = $parent.find('.dName .editText').text();
                item[(ck.csvImport.itemFieldNames.edition)] = $parent.find('.dSet .editEdition').text();
                item[(ck.csvImport.itemFieldNames.foil)] = ($parent.find('.dFoil').text() == 'FOIL' ? 1 : 0);
                item[(ck.csvImport.itemFieldNames.qty)] = $parent.find('.dQty .dQtyValue').text();
                
                for (var i = (ck.csvImport.items).length - 1; i >= 0; i--) {
                    if( ((ck.csvImport.items)[i])[(ck.csvImport.itemFieldNames.id)] == item[(ck.csvImport.itemFieldNames.id)] ){
                        (ck.csvImport.items)[i] = item;
                        break;
                    }
                };
                var $resultsPanel = $parent.parents('.resultsWrapper');
                $parent.remove();
                if( $resultsPanel.find('.result').length < 1 ){ $resultsPanel.css({'display':'none'}); }

                ck.notifyUser.addMsg('"'+item[(ck.csvImport.itemFieldNames.name)] + '/' + item[(ck.csvImport.itemFieldNames.edition)] +'" identified.');
                ck.csvImport.renderResults(ck.csvImport.items);  //needs to include re-render of card with more-than one match
                $('body').removeClass('editInProgress');
                $(document).off('click','.saveEditedCard');

            });

            $(document).off('click','.setEditionItem');
            $(e.target).parent().remove(); //remove edition set list
            
        });  //end on('click','.setEditionItem'..

        _workerMatchMaker.postMessage({'cmd': 'buildUniqueNameList'});
            

    }); //end edit unknown card: on('click','body:not(.editInProgress) .csvEditInvalidItem'...
    
    ck.importBuyList = _public;
    return ck;

})(jQuery,ck||{});

</script>
<script> 


$(function(){

        var _csvConfig = {
            complete: ck.importBuyList.processCsv, 
            error: function(results, file) {
                //error messaging & putting item in "error" bucket
                console.log('csvImport FAILED.',results);
            },
            skipEmptyLines: true
        };
        var _csvFileConfig = {
            complete: ck.importBuyList.processCsv,
            error: function(results, file) {
                ck.notifyUser.addMsg('Unable to parse file. Please see the <span class="viewCsvFaq">CSV Import FAQ</span></a> for help on teh file format.','warning');
            },
            download: true, 
            skipEmptyLines: true
        };
        var _csvUrlConfig = {
            complete: ck.importBuyList.processCsv, 
            download: true,
            error: function(results, file) {
                ck.notifyUser.addMsg( 'Unable to import file from URL. A valid URL looks something like:<br>https://www.cardkingdom.com/media/examples/mtg_card_example.csv','warning');
                
            },
            skipEmptyLines: true
        }

    $(document).on('click','#convertPastedCsv',function(){
        var _rawCsv = $('#csvPaste').val();
        if(_rawCsv.length < 10 ) {
            ck.notifyUser.addMsg('Please paste a CSV into the textbox, or select a file.','warning');
        } else {
            ck.csvImportStartTime = performance.now();
            $('body').addClass('loadingCsv');
            setTimeout(function(){
              Papa.parse(_rawCsv, _csvConfig);  
            },0);
        }
    });
    $("#csvFile").change(function(e){
        var file = e.target.files[0];
        if(Number(file.size) < 4 ){
            ck.notifyUser.addMsg('Selected file was empty.','warning');
        } else {
            $('body').addClass('loadingCsv');
            setTimeout(function(){
              Papa.parse(file, _csvFileConfig); 
            },0);
            
        }
    });
    $(document).on('click','#submitCsvUrl',function(){
        var _url = $('#csvUrl').val();
        if(  validateUrl(_url) ) {
            $('body').addClass('loadingCsv');
            ck.csvImport.source = (_url.split('.'))[1];
            Papa.parse(_url, _csvUrlConfig); 
        } else {
            ck.notifyUser.addMsg('The submitted URL was not valid. A valid URL looks something like:<br>https://www.cardkingdom.com/media/examples/mtg_card_example.csv');
        }   
    });

    function validateUrl(value) {
      return /^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(value);
    }


});
</script>
<script type="text/javascript">
$(function(){

    ck.importBuyList.registerPreProcessor({
        'desc':'prep item structure: trim unneeded and add needed fields',
        'priority':10,
        'func':function(item){
            //if any columns that are used are  > 4th col, remap and replace item
            if(ck.csvImport.itemFieldNames.name > 4 || 
                ck.csvImport.itemFieldNames.edition > 4 || 
                ck.csvImport.itemFieldNames.foil > 4 || 
                ck.csvImport.itemFieldNames.qty > 4 ){
                    var _newItem = [];
                    _newItem[0] = (item[ck.csvImport.itemFieldNames.name-1]);
                    _newItem[1] = (item[ck.csvImport.itemFieldNames.edition-1]);
                    _newItem[2] = (item[ck.csvImport.itemFieldNames.foil-1]);
                    _newItem[3] = (item[ck.csvImport.itemFieldNames.qty-1]);
                    item = _newItem;
            } else {
                 item = item.splice(0,4); 
            }
            item.push([]); //adding array to hold hits.
            return item;
        } 
    });

    ck.importBuyList.registerPreProcessor({
        'desc':'reset itemFieldNames after initial processing',
        'priority':11,
        'func':function(item){
            //if any columns that are used are  > 4th col, remap and replace item
           //this is assuming prep also hit the same logic. better to combine
           if(ck.csvImport.itemFieldNames.name > 4 || 
            ck.csvImport.itemFieldNames.edition > 4 || 
            ck.csvImport.itemFieldNames.foil > 4 || 
            ck.csvImport.itemFieldNames.qty > 4 ) {
                ck.csvImport.itemFieldNames.name = 1;
                ck.csvImport.itemFieldNames.edition = 2;
                ck.csvImport.itemFieldNames.foil = 3;
                ck.csvImport.itemFieldNames.qty = 4;
           }
            return item;
        } 
    });

    //add incremental int index
    ck.importBuyList.registerPreProcessor({
        'desc':'adding incremental unique index',
        'priority':20,
        'func':function(item){
            ck.importBuyList.userItemCount = ck.importBuyList.userItemCount || 0;
            ck.importBuyList.userItemCount++;
            item.splice(0,0,ck.importBuyList.userItemCount);
            return item;
        } 
    });

    ck.importBuyList.registerPreProcessor({
        'desc':'prep edition name',
        'priority':40,
        'func':function(item){
            var _editionColumn = ck.csvImport.itemFieldNames['edition'];
            var _editionName = item[_editionColumn];
            
            //if edition is 3 char length, check for tla and swap if match.
            var _editionTlaName = _editionName.trim().toLowerCase();
            if( _editionTlaName.length === 3){ 
                for (var tlaIndex = (ck.setList).length - 1; tlaIndex >= 0; tlaIndex--) {
                    if( ck.setList[tlaIndex].tla ===  _editionTlaName ){ _editionName = ck.setList[tlaIndex].name; break; }
                }
            } 

            var _swaps = [
                {'search':'Unlimited Edition','replace':'Unlimited'},
                {'search':'m10','replace':'2010 core set'},
                {'search':'m11','replace':'2011 core set'},
                {'search':'m12','replace':'2012 core set'},
                {'search':'m13','replace':'2013 core set'},
                {'search':'m14','replace':'2014 core set'},
                {'search':'m15','replace':'2015 core set'},
                {'search':'magic 11','replace':'2011 core set'},
                {'search':'magic 12','replace':'2012 core set'},
                {'search':'magic 13','replace':'2013 core set'},
                {'search':'magic 14','replace':'2014 core set'},
                {'search':'magic 15','replace':'2015 core set'},
                {'search':'fourth edition','replace':'4th Edition'},
                {'search':'fifth edition','replace':'5th Edition'},
                {'search':'sixth edition','replace':'6th Edition'},
                {'search':'classic ','replace':''},
                {'search':'seventh edition','replace':'7th Edition'},
                {'search':'eighth edition','replace':'8th Edition'},
                {'search':'ninth edition','replace':'9th Edition'},
                {'search':'tenth edition','replace':'10th Edition'},
                {'search':'pds','replace':'premium deck series'},
                {'search':'ftv','replace':'From the Vault'},
                {'search':'.*timeshifted.*','replace':'Timeshifted'},
                {'search':'.*revised.*','replace':'3rd edition'},
                {'search':'^Modern Event Deck.*','replace':'Modern Event Deck'},
                {'search':'^Planechase 2012.*','replace':'Planechase 2012'},
                {'search':'^Limited Edition Alpha','replace':'alpha'},
                {'search':'^Limited Edition Beta','replace':'Beta'},
                {'search':'^magic ','replace':''},
                {'search':'^(\\d{4}).*','replace':'$1 Core Set'},
                {'search':'modern masters (\\d*) .*','replace':'Modern Masters $1'},
                {'search':'commander (\\d*) .*','replace':'Commander $1'},
                {'search':'planechase (\\d*) .*','replace':'Planechase $1'},
                {'search':'origins','replace':'magic origins'},
                {'search':'^Modern Ev.*','replace':'Modern Event Deck'},
                {'search':'.*royale.*','replace':'battle royale'},
                {'search':'beatdown.*','replace':'beatdown'},     
                {'search':'.*promo.*','replace':'promotional'},
                {'search':'.*revised.*','replace':'3rd edition'},
                {'search':'conspiracy: take the crown','replace':'conspiracy - take the crown'}, 
                {'search':' and ','replace':' & '},
                {'search':'From the Vault:[\\s]*20$','replace':'From the Vault: Twenty'},
                {'search':'dd:','replace':'duel decks:'},
                {'search':' v ','replace':' vs. '},
                {'search':' vs ','replace':' vs. '},
                {'search':'Portal Three Kingdoms','replace':'portal 3k'},
                {'search':'Portal Second Age','replace':'portal ii'},
                {'search':'','replace':''},

            ];
            for (var i = 0; i < _swaps.length; i++) {
                var regEx = new RegExp(_swaps[i].search, "ig");
                if(_editionName.length > 0){ _editionName = (_editionName.trim()).replace(regEx, _swaps[i].replace);}
            };
            item[_editionColumn] = _editionName;
            return item;
        } 
    });

    ck.importBuyList.registerPreProcessor({
        'desc':'fix qty',
        'priority':89,
        'func':function(item){
            var _qty = (item[ ( ck.csvImport.itemFieldNames['qty'] ) ]);
            if( typeof _qty == 'undefined'){ _qty = 1;} //if no qty, assume 1  
            item[ ( ck.csvImport.itemFieldNames['qty'] ) ] = _qty;        
            return item;
        } 
    });


    ck.importBuyList.registerPreProcessor({
        'desc':'fix foil responses',
        'priority':90,
        'func':function(item){
            var _isFoil = (item[ ( ck.csvImport.itemFieldNames['foil'] ) ]);
            if( typeof _isFoil == 'undefined'){ _isFoil = 0;} //if no foil, assume it's not
            if( typeof _isFoil == 'string'){ _isFoil = _isFoil.toLowerCase();}
            _isFoil = ( _isFoil === 1 || _isFoil === '1' || _isFoil === 'true' || _isFoil === 'foil' || _isFoil === 'yes') ? '1' : '0';
            item[ ( ck.csvImport.itemFieldNames['foil'] ) ] = _isFoil;
            return item;
        } 
    });

});


</script>
<div id="transferingToCartWrapper">
<div class="transferingToCartMsg">
<p class="largeTransfer">Transferring your cards to the cardkingdom.com cart.<br>Depending on the number of cards, this can take a while. <br>Thank you for your patience.</p>
<div class="loader">Loading...</div>
<p><b><i>Please note: Individual card prices can fluctuate. <br>Please be sure to verify prices in the cart, before submitting order.</i></b></p>
</div>
</div>

<style>
#csvImportFaq {
    display: none;
    height:100%;
    left: 0px;
    padding:20px;
    position: fixed;
    top: 0px;
    width:100%;
    background-color:transparent; 

    z-index: 105;
}
#csvImportFaq .csvImportFaqWrapper {
    background-color: #fff;
    display: block;
    height: 100%;
    

    overflow: auto;
    padding: 15px;
    
    width: 100%;
    -webkit-box-shadow: 0px 0px 35px 15px rgba(0,0,0,0.75);
    -moz-box-shadow: 0px 0px 35px 15px rgba(0,0,0,0.75);
    box-shadow: 0px 0px 35px 15px rgba(0,0,0,0.75);
}

#csvImportFaq .close {
    border: 2px solid #091f47;
    border-radius: 20px;
    color:#091f47;
    display: block;
    font-size: 18px;
    line-height: 18px;
    opacity: .8;
    padding: 0px 5px 1px 5px;
    position: absolute;
    right: 30px;
    top: 30px;
}
.showFaq #csvImportFaq {display: block;}
.showFaq .footer {display: none;}
#csvImportFaq > ul {list-style: none;}
.bulkPricelist{display:block; padding: 15px;}
#csvImportFaq li {padding-bottom: 15px;}
.faqQuestion{
    font-weight: bold;
    cursor: pointer;
}
.faqQuestion:hover{text-decoration: underline;}
</style>
<div id="csvImportFaq"><div class="csvImportFaqWrapper">
<div class="close">X</div>
<h2>CSV Import Tool FAQs</h2>
<ul>
<li><div data-toggle="collapse" data-target="#csvImportFaq .answer1" class="faqQuestion">What is a .CSV file?</div>
<div class="answer1 collapse">A CSV (or comma-separated values) is a simple file format used to store data such as a spreadsheet. Files in CSV format can be easily imported and exported from programs like Excel. Card Kingdom’s import tool requires the use of a CSV to import cards using the import tool.</div>
</li>
<li><div data-toggle="collapse" data-target="#csvImportFaq .answer2" class="faqQuestion">How can I create a CSV file?</div>
<div class="answer2 collapse">A CSV file can created in a text-editor, by hand, exported from an online collection tracker, or a spreadsheet, such as Excel. The file must have the following columns:<br>
<div class="faqSection">o Card Name – The name of the card. Misspelled cards will not be identified. Not case-SEnsitivE<br>
o Edition – The edition that your card appears in.<br>
o Foil - is the card you are selling foil or not. (use 1/true/yes if it is a foil, and 0/false/no if it is not a foil.) (If you are not tracking this information, you will have an option to choose "No Foils" during import process.)<br>
o Quantity – The quantity of the card you wish to sell. Must be numeric (use 2, not two). <br>
<p>Optimally, the first 4 columns of the csv should follow this format:</p>
<p>card name, edition, foil, quantity</p>
<p>Example:<br>wrath of god, portal, false, 10<br>Entomb, Odyssey, true, 4</p>
<br><a href="/media/examples/mtg_card_example.csv" target="_blank">Download an example file</a>
</div>
• When your file is ready in Excel, click File, and then Save As. The default file format will be Excel Workbook. Make sure you scroll down the dropdown menu to change this to CSV (Comma Delimited) and save it. <br>
• Highlight and copy the rows and four columns described above (without the header row as the tool will prompt you to match the columns after import) and paste them into the Card Kingdom CSV Import Tool and submit.</div></li>
<li><div data-toggle="collapse" data-target="#csvImportFaq .answer3" class="faqQuestion">What cards can I sell with this tool?</div>
<div class="answer3 collapse">You may sell any English language cards to Card Kingdom that are on our buy list.<br>
1. If we have an insufficient quantity of a card in stock, that card appears on our buylist and we will pay top dollar for the card. <br>
2. Please note- All cards have a maximum buying threshold. If you are selling a quantity of a title that goes over our buying threshold, we will only pay the full buy price until we reach the threshold number. If you wish to sell a larger quantity, we will buy Mythic Rare, Rare, and full art basic land titles as part of our <a href="/purchasing/mtg_bulk" target="_blank">Bulk Program</a>.</div>
</li>
<li>
<div data-toggle="collapse" data-target="#csvImportFaq .answer4" class="faqQuestion">How many cards may I sell with the CSV Import Tool?</div>
<div class="answer4 collapse">Sell orders are capped at a total of 5000 cards or 500 lines on your CSV file, whichever is less. After transferring cards to the cart, you may add up to 10,000 Rares, 1000 Mythic Rares, and 10,000 full art lands to the order.<p>If you wish you sell your entire collection, please contact <a class="contactBuyer" href="mailto:buyer@cardkingdom.com">buyer@cardkingdom.com</a>.</p></div>
</li>
<li>
<div data-toggle="collapse" data-target="#csvImportFaq .answer5" class="faqQuestion">What do I do once I import the list?</div>
<div class="answer5 collapse">• Look for any unidentified cards. Any card without an exact match will show up here and can be edited by clicking the pencil icon next to the card title. A few reasons a card may not be accepted are:<br>
<div class="faqSection">
1. The card name could be spelled incorrectly. <br>
2. The card may have been designated a foil when no foil exists for the edition chosen.<br>
3. The card does not exist in the edition chosen. <br>
4. The edition name specified is not recognized by the import tool.<br>
5. The card may have multiple variations, like more than one image. If this is the case, click on the correct version pictured to submit.<br>
</div>
• Choose what to sell.<br>
<div class="faqSection">1. If you are happy with the price for all cards, click the green cart icon at the top of each section to add all cards for that section. If you wish to keep some of the cards, click the green cart icon only next to the cards you wish to sell. In addition, you will be able to remove cards or adjust the quantity you wish to sell for each title after you transfer cards to your cart.<br>
2. If you wish to sell additional Mythic Rare, Rare, and/or full art basic land cards, you may now click on the Sell Cards dropdown header, click on Sell MtG in Bulk and add the quantity of each rarity to your cart (note: we only buy bulk cards in NM or EX condition).
</div>
• Click checkout to sell cards and follow the instructions to create a sell order.<br>
</div>
</li>
<li>
<div data-toggle="collapse" data-target="#csvImportFaq .answer6" class="faqQuestion">How can I sort, package, and mail my order to Card Kingdom for payment?</div>
<div class="answer6 collapse">• When you have successfully imported your CSV, checked out, and are ready to mail in the cards, please be aware that the order will need to be sorted in the following format.
<div class="faqSection">1. All buylist cards must be sorted in the exact order that is shown on the Card Kingdom invoice shown at checkout.<br>
2. All bulk cards must be sorted by rarity but it is not necessary to sort them alphabetically or by edition. Bulk cards should be placed at the back of the stack of buy list cards.
</div>
• Failure to sort your cards to our specifications will result in a delay of processing your order or in some cases, having it returned to you.<br>
• Please package the cards carefully to minimize damage by the postal carrier. Card Kingdom is not responsible for packages lost or damaged in transit. <br>
• Please send the package with tracking. We recommend insuring high value shipments.<br>
• Please add the Card Kingdom order number located on your invoice to the outside of the package to speed up processing.</div>
</li>
<li><div data-toggle="collapse" data-target="#csvImportFaq .answer7" class="faqQuestion">Need more help?</div>
<div class="answer7 collapse"><div class="sendUsFeedback"><a class="btn btn-info" href="https://cardkingdom.freshdesk.com/support/tickets/new" target="_blank">Contact Customer Support</a><p>If you are having issues or have other feedback on this tool, please let us know. <br>Be sure to add "csv import tool" to the subject line!</p></div></div></li>
</ul>
</div>
</div>
</div>
<div class="globalPromo container">
<div class="promoSpot item4">
<a href="">
<div class="itemImage"></div>
<span class="icon"></span>

<h3 class=""><span></span></h3>
<div class="text"></div>
</a>
</div>
</div>
</div>
<div class="footer">
<div class="f1 footerTopspots container">
<div class="footerTopspotD">
<a href="https://cardkingdom.freshdesk.com/support/home" target="_blank">
<div class="topspotImage"><span class="glyphicon glyphicon-heart"></span></div>
<div class="topspotHeading">CUSTOMER SERVICE</div>
<div class="topspotSubheading">We're here to help!</div>
</a>
<div class="topspotPrimary">
<a href="https://cardkingdom.freshdesk.com/support/tickets/new">Open new support ticket</a>
<a href="https://cardkingdom.freshdesk.com/support/tickets">Check existing ticket status</a>
</div>
</div>
<div class="footerTopspotC">
<a href="https://app.e2ma.net/app2/audience/signup/1823535/1779405/" target="_blank">
<div class="topspotImage"><span class="glyphicon glyphicon-envelope"></span></div>
<div class="topspotHeading">SIGN-UP FOR EMAIL</div>
<div class="topspotSubheading">News, articles, events &amp; coupons</div>
</a>
<div class="topspotPrimary">
<a href="https://app.e2ma.net/app2/audience/signup/1823535/1779405/" target="_blank">Sign up Now!</a>
</div>
</div>
<div class="footerTopspotLocations">
<div class="topspotImage"><span class=""></span></div>
<div class="topspotHeading">RETAIL LOCATIONS</div>
<div class="topspotSubheading">Mox Boarding House</div>
<div class="topspotPrimary">
<span class="locationLinks locationA">
<a target="_blank" href="https://www.moxboardinghouse.com/locations/">Seattle</a><br>
<a href="https://www.moxboardinghouse.com/seattle-events" target="_blank" class="events">Events</a>
</span>
<span class="locationSeperator bulletB">•</span>
<span class="locationLinks locationB"><a target="_blank" href="https://www.moxboardinghouse.com/locations/">Bellevue</a><br>
<a href="https://www.moxboardinghouse.com/bellevue-events" target="_blank" class="events">Events</a>
</span>
<span class="locationSeperator bulletC">•</span>
<span class="locationLinks locationC">
<a target="_blank" href="https://www.moxboardinghouse.com/coming-soon-mox-pdx/">Portland</a><br>
<a target="_blank" href="https://www.moxboardinghouse.com/coming-soon-mox-pdx/" class="events">Events</a>
</span>
</div>
</div>
</div>
<div class="f2 footerCallout container"><h2>CARD KINGDOM - FROM SEATTLE TO THE WORLD!</h2><a href="https://twitter.com/Card_Kingdom" class="twitterIcon"></a>
<a href="https://www.facebook.com/pages/Seattle-WA/Card-Kingdom/329274456626?ref=search&sid=1347837588.117940062..1" class="facebookIcon"></a>
</div>
<div class="f3 footerLinklist container">
<div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>Magic: the Gathering</b></span>
<ul class="dropdown-menu" id="MenuList0"><li class="standard_format"><a href="/catalog/view/2779">Standard Format</a></li><li class="modern_format"><a href="/catalog/view/2864">Modern Format</a></li><li class="throne_of_eldraine"><a href="/mtg/throne-of-eldraine/singles">Throne of Eldraine</a></li><li class="core_set_2020"><a href="/mtg/core-set-2020/singles">Core Set 2020</a></li><li class="war_of_the_spark"><a href="/mtg/war-of-the-spark/singles">War of the Spark</a></li><li class="ravnica_allegiance"><a href="/mtg/ravnica-allegiance/singles">Ravnica Allegiance</a></li><li class="see_all_magic_sets"><a href="/catalog/magic_the_gathering/by_az">See All Magic Sets</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>Gaming Supplies</b></span>
<ul class="dropdown-menu" id="MenuList1"><li class="albumspages"><a href="/catalog/view/2817">Albums/Pages</a></li><li class="apparel"><a href="/catalog/view/2856">Apparel</a></li><li class="card_sleeves"><a href="/catalog/view/2818">Card Sleeves</a></li><li class="deck_boxes"><a href="/catalog/view/2819">Deck Boxes</a></li><li class="playmats"><a href="/catalog/view/2848">Playmats</a></li><li class="stonescountersdice"><a href="/catalog/view/2820">Stones/Counters/Dice</a></li><li class="giftCert"><a href="/catalog/giftcard">Gift Card/Certificates</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>MTG Tools</b></span>
<ul class="dropdown-menu" id="MenuList2"><li class="advanced_search"><a href="/search/mtg">Advanced Search</a></li><li class="deck_builder"><a href="/builder/beta">Deck Builder</a></li><li class="sell_cards"><a href="/purchasing/mtg_singles">Sell Cards</a></li><li class="grading_guide"><a href="/purchasing/how_to_sell">Grading Guide</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>My Account</b></span>
<ul class="dropdown-menu" id="MenuList3"><li class="profile"><a href="/myaccount/profile">Profile</a></li><li class="order_history"><a href="/myaccount/order_history">Order History</a></li><li class="selling_histor"><a href="/myaccount/selling_history">Selling History</a></li><li class="wish_lists"><a href="/myaccount/wishlist">Wish Lists</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>Knowledge Base (FAQ)</b></span>
<ul class="dropdown-menu" id="MenuList4"><li class="how_to_sell_cards"><a href="/purchasing/how_to_sell">How to Sell Cards</a></li><li class="shipping_questions"><a href="https://cardkingdom.freshdesk.com/support/solutions/articles/3000037550-how-are-cards-shipped-">Shipping Questions</a></li><li class="return_policy"><a href="https://cardkingdom.freshdesk.com/support/solutions/articles/3000043279-what-is-your-return-policy-">Return Policy</a></li><li class="how_to_check_order_status"><a href="https://cardkingdom.freshdesk.com/support/solutions/articles/3000037512-how-do-i-check-my-order-and-sales-">How to Check Order Status</a></li><li class="how_to_track_my_shipment"><a href="https://cardkingdom.freshdesk.com/support/solutions/articles/3000037543-where-can-i-view-my-tracking-link-">How to Track My Shipment</a></li></ul></div><div class="btn-group menuList"><span role="button" class="btn btn-default  mtg"><b>About Us</b></span>
<ul class="dropdown-menu" id="MenuList5"><li class="our_story"><a href="/static/about">Our Story</a></li><li class="privacy_policy"><a href="/static/privacy">Privacy Policy</a></li><li class="terms_of_service"><a href="/static/tos">Terms of Service</a></li><li class="Careers_CL"><a href="https://workforcenow.adp.com/jobs/apply/posting.html?client=CKCM&amp;ccId=19000101_000001&amp;type=MP&amp;lang=en_US">Careers</a></li></ul></div> </div>
<div class="f4 footerFooter container">
<span class="authBadge"></span>
<span class="copyright">&copy; 1999-2019 Card Kingdom, Inc.</span>
</div>
</div>

<script>
/* set focus to search or signin */
$(function(){
    $('[data-toggle="tooltip"]').tooltip();  
    if( $(window).width() > 1200  ) {
        var $input;
        if ( $('body').hasClass('register') ||  $('body').hasClass('customer_login') ) {
            $input = $('input[name=email]');
        } else {
            $input = $('#tags');
        }
        setTimeout(function(){
             $input.focus();
             if($input.length > 0) { $input[0].setSelectionRange(99,99); }
        },100);
    }
});

$('#toggleSideCart').click(function(){
    $('#sidecartContainer,mainWrapper').toggleClass('cartOpen');
});

</script>
<script>


if( $('#search.sidesearch').length > 0 ) {
    var select = document.getElementById('type'),
    onChange = function(event) {
        var shown = this.options[this.selectedIndex].value == 'Creature';
        var any = this.options[this.selectedIndex].value == '';

        document.getElementById('subtype').style.display = any ? 'none' : 'block';
        document.getElementById('powtuf').style.display = shown ? 'block' : 'none';
    };

    // attach event handler
    if(typeof select !== 'undefined' && select !== null) {
        if (window.addEventListener) {
            select.addEventListener('change', onChange, false);
        } else {
            // of course, IE < 9 needs special treatment
            select.attachEvent('onchange', function() {
                onChange.apply(select, arguments);
            });
        }
    }
}

$("#more_options").click(function(e) {
    document.getElementById('more_options').style.display = 'none';
});

$("#less_options").click(function(e) {
    $("#moreFilters").addClass('in');
    document.getElementById('more_options').style.display = 'block';
});

//setting header item counter
setTimeout(function(){
    ck.setCartCountDisplay(0);
    ck.setSellCartCountDisplay(0);

},0);

</script>
</body>
</html>

